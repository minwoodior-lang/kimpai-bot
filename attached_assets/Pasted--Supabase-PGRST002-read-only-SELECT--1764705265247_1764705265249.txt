ì•ˆë…•í•˜ì„¸ìš”.
í˜„ì¬ Supabaseì—ì„œ ì§€ì†ì ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆ ìºì‹œ ì˜¤ë¥˜(PGRST002), read-only ëª¨ë“œ ì „í™˜, SELECT ì‹¤íŒ¨ ë“±ì´ ë°œìƒí•˜ì—¬ í”„ë¦¬ë¯¸ì—„ í…Œì´ë¸”Â·ì‹¬ë³¼ ë¡œë”©Â·ë§ˆì¼“ ë©”íƒ€ë°ì´í„° ë“± í•µì‹¬ ê¸°ëŠ¥ì´ ëª¨ë‘ ì¤‘ë‹¨ë˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ ë¬¸ì œëŠ” Supabase ì¸í”„ë¼ê°€ ìë™ ë³µêµ¬ë  ë•Œê¹Œì§€ í•´ê²°í•  ìˆ˜ ì—†ìœ¼ë©°, ì„œë¹„ìŠ¤ í•µì‹¬ ê¸°ëŠ¥ì´ Supabaseì— ê³¼ë„í•˜ê²Œ ì˜ì¡´ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì¥ì• ê°€ ë°˜ë³µë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

ë”°ë¼ì„œ Supabaseë¥¼ ì™„ì „íˆ ì œê±°í•˜ê³ , ì‹œì„¸Â·í”„ë¦¬ë¯¸ì—„Â·ì‹¬ë³¼Â·ë©”íƒ€ë°ì´í„°ëŠ” Replit ë¡œì»¬ ê¸°ë°˜ìœ¼ë¡œ ì „í™˜í•´ì•¼ í•©ë‹ˆë‹¤.

ì•„ë˜ 3ê°œì˜ íŒŒì¼ì„ ìƒˆë¡œ ìƒì„± ë˜ëŠ” êµì²´í•´ ì£¼ì„¸ìš”.

ğŸ”§ 1) scripts/priceWorker.ts (ìƒˆ íŒŒì¼ë¡œ êµì²´)

ì—­í• :

ì—…ë¹„íŠ¸Â·ë¹—ì¸Â·OKX APIì—ì„œ ì‹œì„¸ ê°€ì ¸ì˜¤ê¸°

í”„ë¦¬ë¯¸ì—„ ê³„ì‚°

Supabase ì €ì¥ ë¡œì§ ì‚­ì œ

ê²°ê³¼ë¥¼ /data/premiumTable.json íŒŒì¼ë¡œ ì €ì¥

// scripts/priceWorker.ts
import fs from "fs";
import path from "path";
import axios from "axios";

async function fetchPrices() {
  const [upbit, bithumb, okx] = await Promise.all([
    axios.get("https://api.upbit.com/v1/ticker?markets=KRW-BTC"),
    axios.get("https://api.bithumb.com/public/ticker/BTC_KRW"),
    axios.get("https://www.okx.com/api/v5/market/ticker?instId=BTC-USDT")
  ]);

  const upbitPrice = upbit.data[0].trade_price;
  const bithumbPrice = Number(bithumb.data.data.closing_price);
  const okxPrice = Number(okx.data.data[0].last) * 1340;

  const premium = ((upbitPrice - okxPrice) / okxPrice) * 100;

  const result = [{
    symbol: "BTC",
    koreanPrice: upbitPrice,
    globalPriceKrw: okxPrice,
    premium,
    domesticExchange: "UPBIT",
    foreignExchange: "OKX"
  }];

  const filePath = path.join(process.cwd(), "data/premiumTable.json");
  fs.writeFileSync(filePath, JSON.stringify(result, null, 2));
}

fetchPrices();

ğŸ”§ 2) pages/api/premium/table.ts (Supabase ì™„ì „ ì œê±° í›„ íŒŒì¼ ê¸°ë°˜ APIë¡œ ì „í™˜)

ì—­í• :

premiumTable.json ì½ê¸°

symbolMetadata.jsonê³¼ ë§¤í•‘

Supabase ì¿¼ë¦¬ ì „ë¶€ ì‚­ì œ

// pages/api/premium/table.ts
import fs from "fs";
import path from "path";
import { NextApiRequest, NextApiResponse } from "next";

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  const premiumPath = path.join(process.cwd(), "data/premiumTable.json");
  const metaPath = path.join(process.cwd(), "data/symbolMetadata.json");

  const premiumData = JSON.parse(fs.readFileSync(premiumPath, "utf8"));
  const meta = JSON.parse(fs.readFileSync(metaPath, "utf8"));

  const mapped = premiumData.map((item: any) => {
    const m = meta[item.symbol] || {};
    return {
      ...item,
      name_ko: m.name_ko || item.symbol,
      name_en: m.name_en || item.symbol,
      icon_url: m.icon_url || null
    };
  });

  res.status(200).json({ data: mapped });
}

ğŸ”§ 3) utils/metadataMapper.ts (ì‹¬ë³¼/ì´ë¦„/ì•„ì´ì½˜ í†µì¼ ë§¤í¼)

ì—­í• :

AMP/AMP, MANTA/MANTA ê°™ì€ ì¤‘ë³µ ì‹¬ë³¼ì„ ì •ê·œí™”

í•œê¸€ëª…/ì˜ë¬¸ëª…/ì•„ì´ì½˜ ë§¤ì¹­

// utils/metadataMapper.ts
export function normalizeSymbol(symbol: string) {
  return symbol.replace(/[^A-Za-z0-9]/g, "").toUpperCase();
}

export function attachMetadata(item: any, meta: any) {
  const s = normalizeSymbol(item.symbol);
  const m = meta[s] || {};

  return {
    ...item,
    name_ko: m.name_ko || s,
    name_en: m.name_en || s,
    icon_url: m.icon_url || null
  };
}

ğŸš¨ ë ˆí”Œë¦¿ì´ ë°˜ë“œì‹œ í•´ì•¼ í•˜ëŠ” ì‘ì—… ìš”ì•½
âœ” Supabase ì˜ì¡´ ì½”ë“œ ì „ì²´ ì‚­ì œ
âœ” priceWorker.tsë¥¼ ë¡œì»¬ JSON ì €ì¥ êµ¬ì¡°ë¡œ êµì²´
âœ” í”„ë¦¬ë¯¸ì—„ APIëŠ” JSON íŒŒì¼ ì½ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½
âœ” master_symbols / exchange_markets / ë§¤í•‘ í…Œì´ë¸” SELECT ì „ë¶€ ì œê±°
âœ” í™ˆ í”„ë¦¬ë¯¸ì—„ í…Œì´ë¸”ì€ Supabase ì—†ì´ ì •ìƒ ë™ì‘í•´ì•¼ í•¨
ğŸ’¡ ì‘ì—… ì™„ë£Œë˜ë©´ ê²°ê³¼ëŠ” ì´ë ‡ê²Œ ë¨

Supabase ì£½ì–´ë„ ê¹€í”„ í‘œ ì •ìƒ ëœ¸

ì‹¬ë³¼/ì´ë¦„/ì•„ì´ì½˜ ì •ìƒ

PGRST002, read-only, ìºì‹œ ì˜¤ë¥˜ â†’ 0%

ë ˆí”Œë¦¿ ë¡œì»¬ íŒŒì¼ ê¸°ë°˜ì´ë¼ ì†ë„ ë¹¨ë¼ì§

ì¥ì•  ì›ì¸ ì™„ì „ ì œê±°