0. 문제 요약 (레플릿용 설명)

현재 PremiumTableRow에서

김프/전일/고가/저가 하단 금액을 전부 row.premiumDiffKrw, row.changeAbsKrw, row.highDiffKrw, row.lowDiffKrw 그대로 사용하고 있음.

그런데 API에서 이 필드들이 대부분 0으로 내려와서, 화면에 ₩0.00000000처럼 잘못 표시되는 상태.

또, 김프 하단 금액은 “국내가 - 해외가” 가 되어야 하는데, 지금 값이 달라 김프가와 어긋남.

해결 방법:
백엔드는 그대로 두고, PremiumTableRow 안에서 김프가와 동일한 공식으로

김프 차액

전일대비 차액

고가/저가 차액
을 프론트에서 다시 계산해서 사용하도록 변경.

1. 수정 범위

파일: src/components/PremiumTable.tsx

컴포넌트: PremiumTableRow

나머지 파일/백엔드/워커는 절대 수정하지 말 것.

2. PremiumTableRow 상단에 “표시용 파생값” 계산 추가

PremiumTableRow 함수 내부에서,
uniqueKey, normalizedSymbol, isFav 등을 계산하는 위치 바로 아래에
다음 코드를 추가(또는 기존 prevDiff/highDiff/lowDiff 계산 로직을 이걸로 교체) 해 주세요.

const uniqueKey = `${row.symbol}_${index}`;
const normalizedSymbol = row.symbol
  .replace("/KRW", "")
  .replace("/USDT", "")
  .replace("/BTC", "")
  .toUpperCase();
const isFav = favorites.has(normalizedSymbol);
const isUnlisted = !row.foreignPriceKrw || row.foreignPriceKrw <= 0;

// === 김프가 스타일로 맞추기 위한 표시용 파생 값들 ===

// 국내가가 유효한지 체크
const hasDomesticPrice =
  row.koreanPrice !== null &&
  row.koreanPrice !== undefined &&
  !Number.isNaN(row.koreanPrice);

// 1) 김프 차액 (국내가 - 해외가)
//    → 김프가 하단 숫자와 동일한 개념
const premiumDiffKrw =
  hasDomesticPrice &&
  row.foreignPriceKrw !== null &&
  row.foreignPriceKrw !== undefined &&
  row.foreignPriceKrw > 0
    ? row.koreanPrice - row.foreignPriceKrw
    : null;

// 2) 전일대비 차액 (현재가 - 전일 종가)
//    changeRate 또는 change24h 둘 중 존재하는 퍼센트에서 역산
const changePercentSource =
  row.changeRate !== null &&
  row.changeRate !== undefined &&
  !Number.isNaN(row.changeRate)
    ? row.changeRate
    : row.change24h !== null &&
      row.change24h !== undefined &&
      !Number.isNaN(row.change24h)
    ? row.change24h
    : null;

let prevClose: number | null = null;
if (
  hasDomesticPrice &&
  changePercentSource !== null &&
  changePercentSource !== undefined
) {
  const ratio = 1 + changePercentSource / 100;
  if (ratio !== 0) {
    prevClose = row.koreanPrice / ratio;
  }
}

const changeAbsKrw =
  hasDomesticPrice && prevClose !== null ? row.koreanPrice - prevClose : null;

// 3) 고가대비 / 저가대비 차액
//    고가대비 하단: (고가 - 현재가)
//    저가대비 하단: (현재가 - 저가)
const highDiffKrw =
  hasDomesticPrice &&
  row.high24h !== null &&
  row.high24h !== undefined
    ? row.high24h - row.koreanPrice
    : null;

const lowDiffKrw =
  hasDomesticPrice &&
  row.low24h !== null &&
  row.low24h !== undefined
    ? row.koreanPrice - row.low24h
    : null;


🔥 기존에 prevDiff, highDiff, lowDiff 같은 이름으로 diff 계산하던 코드가 있으면 완전히 삭제하고 위 로직만 남겨 주세요.
(그래야 중복 계산/혼동 없음)

3. 각 칼럼에서 row.*DiffKrw 대신 새 변수 사용
3-1. 현재가 칼럼은 그대로 유지

현재가 칼럼(국내/해외) 부분은 지금 코드 그대로 유지하면 됩니다:

<td className="w-[110px] sm:w-[140px] px-1 sm:px-2 md:px-3 lg:px-4 py-1 sm:py-1.5 md:py-3 text-right whitespace-nowrap">
  <TwoLinePriceCell
    topValue={row.koreanPrice}
    bottomValue={row.foreignPriceKrw}
    isUnlisted={isUnlisted}
  />
</td>

3-2. 김프 칼럼 – 하단을 premiumDiffKrw 로 교체
<td className="w-[85px] sm:w-[90px] px-1 sm:px-2 md:px-3 lg:px-4 py-1 sm:py-1.5 md:py-3 text-right whitespace-nowrap">
  <TwoLineCell
    line1={isUnlisted ? "-" : formatPercent(row.premiumRate)}
    // ⬇️ 기존: row.premiumDiffKrw → 새로 계산한 premiumDiffKrw 사용
    line2={formatKrwDynamic(premiumDiffKrw, { signed: true })}
    line1Color={isUnlisted ? "text-gray-500" : getPremiumColor(row.premiumRate)}
    isUnlisted={isUnlisted}
  />
</td>

3-3. 전일대비 칼럼 – 하단을 changeAbsKrw 로 교체
<td className="w-[90px] sm:w-[100px] px-1 sm:px-2 md:px-3 lg:px-4 py-0.5 sm:py-1 md:py-3 text-right whitespace-nowrap">
  <TwoLineCell
    line1={formatPercent(row.changeRate)}
    // ⬇️ 기존: row.changeAbsKrw → 새로 계산한 changeAbsKrw 사용
    line2={formatKrwDynamic(changeAbsKrw, { signed: true })}
    line1Color={getChangeColor(row.changeRate)}
  />
</td>

3-4. 고가대비 / 저가대비 칼럼 – 하단을 highDiffKrw / lowDiffKrw 로 교체
{/* 고가대비 */}
<td className="hidden md:table-cell w-[90px] sm:w-[100px] px-1 sm:px-2 md:px-3 lg:px-4 py-1 sm:py-1.5 md:py-3 text-right whitespace-nowrap">
  <TwoLineCell
    line1={formatPercent(row.fromHighRate)}
    // ⬇️ 기존: row.highDiffKrw → highDiffKrw 사용
    // 김프가처럼 단순 숫자만 보이게 부호 없이(signed: false) 가는 것도 가능
    line2={formatKrwDynamic(highDiffKrw, { signed: false })}
    line1Color={getChangeColor(row.fromHighRate)}
  />
</td>

{/* 저가대비 */}
<td className="hidden md:table-cell w-[90px] sm:w-[100px] px-1 sm:px-2 md:px-3 lg:px-4 py-1 sm:py-1.5 md:py-3 text-right whitespace-nowrap">
  <TwoLineCell
    line1={formatPercent(row.fromLowRate)}
    // ⬇️ 기존: row.lowDiffKrw → lowDiffKrw 사용
    line2={formatKrwDynamic(lowDiffKrw, { signed: false })}
    line1Color={getChangeColor(row.fromLowRate)}
  />
</td>


만약 고가/저가 하단도 +₩... / -₩... 부호를 붙이고 싶으면
signed: true 로만 바꾸면 됩니다. 구조는 동일.

4. 이 패치로 기대되는 결과

김프 하단
→ 김프가와 동일하게 국내가 - 해외가 차액으로 표시

전일대비 하단
→ 현재가 - 전일종가로 계산된 금액이 표시 (지금처럼 전부 0 아님)

고가대비/저가대비 하단
→ 고가/저가와의 실제 가격 차이를 표시,
김프가 스샷의 0.002222, 0.0000575 같은 숫자 형태와 동일한 구조

API가 *_DiffKrw 필드를 0으로 내려줘도 상관 없음.
→ 프론트에서 koreanPrice, foreignPriceKrw, changeRate, high24h, low24h만으로
김프가와 같은 로직을 다시 계산하기 때문.