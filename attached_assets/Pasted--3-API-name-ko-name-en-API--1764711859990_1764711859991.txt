ğŸ“ ì½”ì¸ ë°ì´í„° ìˆ˜ì§‘ íŒŒì¼ (ìƒˆ êµ¬ì¡°)

í•µì‹¬ ì›ì¹™:

ê¸°ì¤€ì€ êµ­ë‚´ 3ê±°ë˜ì†Œ ìƒì¥ ì½”ì¸ë§Œ

ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ëŠ” ê³µì‹ API

ì´ë¦„(name_ko/name_en)ì€

ì—…ë¹„íŠ¸: API

ì½”ì¸ì›: ê³ ê°ì„¼í„° í…Œì´ë¸” í¬ë¡¤ë§

ë¹—ì¸: ê¸°ì¡´ syncBithumbNames.ts ì´ë¦„ë§µ

í•´ì™¸ ê±°ë˜ì†ŒëŠ” â€œê°€ê²©ë§Œ ê°€ì ¸ì˜¤ëŠ” ìš©ë„â€

ğŸ”¥ Stage 0: ê¸°ì¡´ íŒŒì´í”„ë¼ì¸ ì „ë¶€ íê¸°

ì‚­ì œ/ë¬´ì‹œí•  ê²ƒ:

scripts/syncUpbitMarkets.ts (í˜„ì¬ ë²„ì „ ë¡œì§)

scripts/syncBithumbMarkets.ts (í˜„ì¬ ë²„ì „ ë¡œì§)

scripts/syncCoinoneMarkets.ts (í˜„ì¬ ë²„ì „ ë¡œì§)

data/exchange_markets.json (ì§€ê¸ˆ íŒŒì¼)

scripts/priceWorker.ts (êµ­ë‚´ 664ê°œë§Œ ê¸°ì¤€ìœ¼ë¡œ ë„ëŠ” í˜„ì¬ ë²„ì „ ì„¤ëª…)

ì´ ë¬¸ì„œì— ì íŒ â€œStage 1~3 (664ê°œ ê¸°ì¤€)â€ ì„¤ê³„ëŠ” ì „ë¶€ íê¸°í•˜ê³ ,
ì•„ë˜ ìƒˆ êµ¬ì¡°ë¡œ ê°ˆì•„íƒ€ì•¼ í•¨.

âœ… ìƒˆ êµ¬ì¡° ìš”ì•½
ğŸ“Œ ìµœì¢… ëª©í‘œ íŒŒì¼ 2ê°œë§Œ ìœ ì§€

data/exchange_markets.json

êµ­ë‚´ 3ê±°ë˜ì†Œ ì „ì²´ ë§ˆì¼“

ê° ë§ˆì¼“ì— name_ko / name_en / icon_urlê¹Œì§€ í¬í•¨

data/premiumTable.json

ìœ„ exchange_markets.json ê¸°ì¤€ìœ¼ë¡œ

í•´ì™¸ ì‹œì„¸ ë¶™ì—¬ì„œ í”„ë¦¬ë¯¸ì—„ ê³„ì‚°í•œ ìµœì¢… í…Œì´ë¸”

APIëŠ” ê·¸ëŒ€ë¡œ /api/premium/tableê°€ premiumTable.jsonë§Œ ì½ìœ¼ë©´ ë¨.

Stage 1: êµ­ë‚´ ê±°ë˜ì†Œ ë§ˆì¼“ + ì´ë¦„ ìˆ˜ì§‘ (ì™„ì „ ìƒˆë¡œ ì •ì˜)
1-1. ì—…ë¹„íŠ¸ â€“ scripts/syncUpbitMarkets.ts

ì†ŒìŠ¤

GET https://api.upbit.com/v1/market/all?isDetails=true


ìˆ˜ì§‘ ë²”ìœ„

KRW / BTC / USDT ë§ˆì¼“ ì „ì²´

ë¡œì§ (ìš”ì•½)

// 1) Upbit API í˜¸ì¶œ
// 2) KRW/BTC/USDTë§Œ í•„í„°
// 3) ì•„ë˜ í˜•íƒœë¡œ ë§¤í•‘
{
  exchange: "UPBIT",
  market: "KRW-BTC",
  base_symbol: "BTC",
  quote_symbol: "KRW",
  name_ko: korean_name,   // ì—…ë¹„íŠ¸ ê³µì‹ í•œê¸€ëª…
  name_en: english_name,  // ì—…ë¹„íŠ¸ ê³µì‹ ì˜ë¬¸ëª…
  icon_url: null          // ì•„ì´ì½˜ì€ ë‚˜ì¤‘ì— symbolIcons.jsonì—ì„œ ë¶™ì´ê±°ë‚˜ ë³„ë„ ì²˜ë¦¬
}


ì €ì¥ ë°©ì‹

ê¸°ì¡´ data/exchange_markets.jsonëŠ” ì‚­ì œ

ìƒˆë¡œ ë§Œë“¤ ë•Œ:

ì²« ì‹¤í–‰: ì—…ë¹„íŠ¸ ë°ì´í„°ë¡œ íŒŒì¼ ìƒì„±

ì´í›„ ë¹—ì¸/ì½”ì¸ì› ìŠ¤í¬ë¦½íŠ¸ê°€ append (merge) í˜•ì‹ìœ¼ë¡œ ì¶”ê°€

1-2. ì½”ì¸ì› â€“ scripts/syncCoinoneMarkets.ts (í˜•ë‹˜ì´ ë¶™ì—¬ì¤€ ê·¸ ë¡œì§ ê¸°ì¤€)
(A) ì´ë¦„ë§µ í¬ë¡¤ëŸ¬ â€“ fetchCoinoneSupportNameMap()

ì†ŒìŠ¤ (ê³ ê°ì„¼í„° ë¬¸ì„œ)

â€œì½”ì¸ì›ì—ì„œ ì§€ì› ì¤‘ì¸ ê°€ìƒìì‚° ì¢…ë¥˜ ë° ë„¤íŠ¸ì›Œí¬ ìœ í˜•â€

ì—¬ê¸°ì„œ:

ì‹¬ë³¼

êµ­ë¬¸ëª…

ì˜ë¬¸ëª…

ì„ ì „ë¶€ í…Œì´ë¸”ì—ì„œ íŒŒì‹±.

ì—­í• 

type CoinoneNameMap = Record<string, { ko: string | null; en: string | null }>;

async function fetchCoinoneSupportNameMap(): Promise<CoinoneNameMap> {
  // 1) HTML GET
  // 2) cheerioë¡œ table tbody tr ìˆœíšŒ
  // 3) td[0] = ì‹¬ë³¼, td[1] = êµ­ë¬¸ëª…, td[2] = ì˜ë¬¸ëª…
  // 4) symbol.toUpperCase() ê¸°ì¤€ìœ¼ë¡œ map[symbol] = { ko, en }
}

(B) ë§ˆì¼“ + ì´ë¦„ merge â€“ syncCoinoneMarkets.ts

ì†ŒìŠ¤

GET https://api.coinone.co.kr/public/v2/markets/KRW


ë¡œì§

async function syncCoinoneMarkets() {
  const [marketsRes, nameMap] = await Promise.all([
    fetch("https://api.coinone.co.kr/public/v2/markets/KRW"),
    fetchCoinoneSupportNameMap(),
  ]);

  const json = await marketsRes.json();
  const markets = json.markets ?? [];

  const rows = markets.map((m) => {
    const base = (m.target_currency ?? "").toUpperCase();
    const names = nameMap[base] ?? { ko: null, en: null };

    return {
      exchange: "COINONE",
      market: m.market,          // ex: "BTC-KRW"
      base_symbol: base,         // "BTC"
      quote_symbol: m.base_currency, // "KRW"
      name_ko: names.ko,         // ê³ ê°ì„¼í„° êµ­ë¬¸ëª…
      name_en: names.en,         // ê³ ê°ì„¼í„° ì˜ë¬¸ëª…
      icon_url: null,
    };
  });

  // data/exchange_markets.jsonì— append / merge
}


ì €ì¥

ê¸°ì¡´ exchange_markets.json ë¡œë”© â†’ COINONE ì•„ë‹Œ row ìœ ì§€

Coinone rows merge â†’ ê°™ì€ {exchange, market}ëŠ” upsert

1-3. ë¹—ì¸ â€“ scripts/syncBithumbMarkets.ts

ì „ì œ

ë¹—ì¸ ê³µì‹ APIì—ëŠ” í•œê¸€ëª…ì´ ì—†ìŒ

ì˜ˆì „ì— ì´ë¯¸ syncBithumbNames.tsë¡œ

400ê°œ+ ì‹¬ë³¼ì— ëŒ€í•´

name_ko / name_en ë§µì„ ì™„ì„±í•´ë‘” ìƒíƒœì˜€ìŒ
(ì´ ë§µì„ ê·¸ëŒ€ë¡œ ì‹ ë¢°í•´ì„œ ì‚¬ìš©)

(A) ì´ë¦„ë§µ â€“ syncBithumbNames.ts ê²°ê³¼ ì¬ì‚¬ìš©

í˜•íƒœ ì˜ˆ:

const bithumbNames: Record<string, { name_ko: string; name_en: string }> = {
  BTC: { name_ko: "ë¹„íŠ¸ì½”ì¸", name_en: "Bitcoin" },
  ETH: { name_ko: "ì´ë”ë¦¬ì›€", name_en: "Ethereum" },
  // ...
};

(B) ë§ˆì¼“ + ì´ë¦„ merge â€“ syncBithumbMarkets.ts

ì†ŒìŠ¤

https://api.bithumb.com/public/ticker/ALL ë˜ëŠ”

ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸ìš© API (KRW/BTC/USDT ì „ì²´)

ë¡œì§

async function syncBithumbMarkets() {
  const markets = await fetchBithumbMarkets(); // KRW/BTC/USDT ë§ˆì¼“ ë¦¬ìŠ¤íŠ¸
  const rows = markets.map((m) => {
    const symbol = m.target_currency.toUpperCase();
    const names = bithumbNames[symbol] ?? { name_ko: null, name_en: null };

    return {
      exchange: "BITHUMB",
      market: `${m.base_currency}-${symbol}`, // ex: "KRW-BTC"
      base_symbol: symbol,
      quote_symbol: m.base_currency,          // KRW/BTC/USDT
      name_ko: names.name_ko,
      name_en: names.name_en,
      icon_url: null,
    };
  });

  // data/exchange_markets.jsonì— append / merge
}


ì €ì¥

ê¸°ì¡´ exchange_markets.json ë¡œë”© â†’ BITHUMB ì•„ë‹Œ row ìœ ì§€

ë¹—ì¸ rows merge (on {exchange, market})

Stage 2: ì‹¤ì‹œê°„ ì‹œì„¸ + í”„ë¦¬ë¯¸ì—„ ê³„ì‚° â€“ scripts/priceWorker.ts

ì…ë ¥
data/exchange_markets.json
â†’ ì´ì œëŠ” Upbit + Bithumb + Coinone ëª¨ë‘ í¬í•¨

ì—­í• 

ê° row(êµ­ë‚´ ë§ˆì¼“)ì— ëŒ€í•´:

êµ­ë‚´ ê±°ë˜ì†Œ í˜„ì¬ê°€ (koreanPrice)

í•´ì™¸ ê±°ë˜ì†Œ(OKX, Binance, â€¦) ê¸€ë¡œë²Œ ê°€ê²© (globalPrice) ì¡°íšŒ

ê¹€í”„ ê³„ì‚°: premium = (koreanPrice / globalPriceKrw - 1) * 100

í•„ìš”í•œ ë¶€ê°€ ì •ë³´ë„ í•¨ê»˜ ê³„ì‚° (volume, high/low diff ë“±)

ì¶œë ¥: data/premiumTable.json

í•„ë“œ ì˜ˆ:

{
  symbol: "BTC",
  exchange: "UPBIT",           // êµ­ë‚´ ê¸°ì¤€ ê±°ë˜ì†Œ
  koreanPrice: 135638000,
  globalPrice: 90916.1,
  globalPriceKrw: 133502110,
  premium: 1.6,
  volume24hKrw: ...,
  volume24hUsdt: ...,
  change24h: ...,
  name_ko: "ë¹„íŠ¸ì½”ì¸",
  name_en: "Bitcoin",
  icon_url: "..." | null,
}


í•µì‹¬:
premiumTable.jsonì€ ë¬´ì¡°ê±´ exchange_markets.json ê¸°ì¤€ìœ¼ë¡œ ë§Œë“¤ê³ ,
ë” ì´ìƒ ì¤‘ê°„ì— ì‹¬ë³¼ ê¸°ì¤€ groupBy/ì¶•ì•½í•˜ì§€ ë§ ê²ƒ.

Stage 3: API ì œê³µ â€“ src/pages/api/premium/table.ts

ì…ë ¥

data/premiumTable.json

ì—­í• 

ê·¸ëŒ€ë¡œ JSON ì‘ë‹µ ë°˜í™˜

í”„ë¡ íŠ¸ì—ì„œ ì“°ëŠ” í•„ë“œëŠ” ê¸°ì¡´ê³¼ ë™ì¼ (exchange, symbol, koreanPrice, globalPrice, premium, name_ko, name_en, icon_url ë“±)

ì£¼ì˜

ë°±ì—”ë“œì—ì„œ ì´ë¯¸ ì´ë¦„/ì•„ì´ì½˜ê¹Œì§€ ì±„ì›Œì„œ ì˜¤ê¸° ë•Œë¬¸ì—
í”„ë¡ íŠ¸ì—ì„œëŠ” ì¶”ê°€ ë¨¸ì§€/lookup í•˜ì§€ ë§ê³  ê·¸ëŒ€ë¡œ ì“°ê¸°.

ğŸ”„ ìƒˆ ì „ì²´ ë°ì´í„° íë¦„
ì—…ë¹„íŠ¸ API        ë¹—ì¸ API        ì½”ì¸ì› API + ê³ ê°ì„¼í„° HTML
   â†“                 â†“                      â†“
syncUpbitMarkets   syncBithumbMarkets   syncCoinoneMarkets
   â†“                 â†“                      â†“
         data/exchange_markets.json  (êµ­ë‚´ 3ê±°ë˜ì†Œ ì „ì²´ ë§ˆì¼“ + ì´ë¦„)
                          â†“
               scripts/priceWorker.ts
      (êµ­ë‚´ ë§ˆì¼“ë³„ ì‹œì„¸ + í•´ì™¸ ì‹œì„¸ + í”„ë¦¬ë¯¸ì—„ ê³„ì‚°)
                          â†“
              data/premiumTable.json
                          â†“
             /api/premium/table (í”„ë¡ íŠ¸)

ğŸš€ ìƒˆ ì‹¤í–‰ ëª…ë ¹ì–´ (ìˆœì„œ)
# 1. êµ­ë‚´ 3ê±°ë˜ì†Œ ë§ˆì¼“ + ì´ë¦„ ìˆ˜ì§‘
npx tsx scripts/syncUpbitMarkets.ts
npx tsx scripts/syncBithumbMarkets.ts
npx tsx scripts/syncCoinoneMarkets.ts

# 2. í”„ë¦¬ë¯¸ì—„ ê³„ì‚°
npx tsx scripts/priceWorker.ts