[빗썸 전체 로직 재점검 요청 – KRW/BTC 마켓 + 암호화폐 총 개수 + 국내 현재가 누락 문제]

현재 업비트 / 코인원은 정상 동작하지만,
빗썸 쪽은 KRW/BTC 마켓 전체 로직이 잘못되어 있는 것 같습니다.

1) 증상 정리

암호화폐 총 개수 불일치

KR 기준 거래소를 빗썸 KRW 또는 빗썸 BTC로 선택한 상태에서
해외 거래소 드롭다운(OKX, Binance, Bybit, …)을 바꾸면
→ 상단에 표시되는 암호화폐 총 N개 숫자가 매번 달라집니다.

반면 업비트 KRW/BTC/USDT, 코인원 KRW는
해외 거래소를 어떻게 바꿔도 항상 같은 개수가 유지됩니다.

정상 동작:

암호화폐 총 개수는 “선택된 국내 거래소에 상장된 심볼 수”만을 기준으로 해야 하고,
해외 거래소를 바꿔도 이 숫자는 변하지 않아야 합니다.

빗썸 상장 코인인데 국내 현재가가 0 또는 -로 나오는 종목 다수

빗썸에 상장된 코인임에도,

행이 아예 안 보이거나

국내 현재가가 ₩0.0000 또는 -로 표기되고
김프가 -100%로 찍히는 사례가 많습니다.

같은 심볼이라도 업비트 기준으로 보면 정상인데,
빗썸 기준에서만 깨지는 경우들이 있습니다.

빗썸 USDT 마켓은 존재하지 않는데, 로직상 USDT 축도 가정하고 있는 느낌

빗썸은 KRW/BTC 마켓만 존재하는데,
현재 로직에서 BITHUMB_USDT 축을 전제하고 있으면
심볼 매핑/개수 계산이 틀어질 수 있습니다.

2) 우리가 원하는 “정상 동작 규칙”

유니버스(코인 목록) 정의

선택된 국내 거래소 기준:

업비트 KRW/BTC/USDT

빗썸 KRW/BTC

코인원 KRW

→ 해당 거래소에 상장된 심볼들의 집합이 유니버스입니다.

해외 거래소는 “이 유니버스를 기준으로 시세를 붙이는 역할”만 해야 하고,
해외 거래소 선택에 따라 유니버스 자체가 줄거나 늘면 안 됩니다.

암호화폐 총 개수

totalCryptoCount는

totalCryptoCount = distinctSymbolsOf(selectedDomesticExchange);


로 계산되어야 하고,

해외 거래소를 어떤 걸 선택하든 이 숫자는 변하지 않아야 합니다.

행 제거 조건

현재는 빗썸 쪽에서
“해외 가격이 없으면 row를 아예 날리거나,
업비트/코인원 기준 심볼과 join 실패한 경우도 드랍”
하는 로직이 있는 것 같습니다.

원하는 규칙은:

hasDomestic = !!domesticPriceKrw;
hasForeign  = !!foreignPriceKrw;

// 둘 다 없을 때만 제거
if (!hasDomestic && !hasForeign) drop;
// 국내만 있어도 row 유지, 해외만 있어도 row 유지


즉, 국내 가격만 있어도 행은 반드시 살아 있어야 합니다.

빗썸 KRW/BTC 원화 환산

KRW 마켓: 그대로 사용

BTC 마켓:

domesticPriceKrw = coinPriceBtc * btcKrwPriceOfBithumb;


빗썸 전용 코인도 KRW 혹은 BTC 마켓이 있으면
국내 현재가가 항상 채워져야 합니다.

3) 점검/수정이 필요한 후보 지점

빗썸 마켓 수집 스크립트 (예: syncBithumbMarkets / exchange_markets.json)

빗썸 KRW/BTC 마켓이 exchange_markets에 제대로 전부 들어오는지
(특히 BTC 전용 코인들) 확인 부탁드립니다.

심볼/마켓 네이밍(SYMBOL_KRW, SYMBOL_BTC)이
master_symbols / premiumTable 생성 시와 일관된지 체크 필요합니다.

premiumTable 생성 시 빗썸 관련 join/filter

현재 빗썸은

해외 거래소에 심볼이 없으면 row를 제거하거나

업비트 기준 심볼과 inner join 해서 빗썸 전용 코인들이 드랍되는 것 같습니다.

빗썸이 “선택된 국내 기준 거래소”일 때는
빗썸 유니버스를 기준으로 left join 해야 합니다.

totalCryptoCount 계산 로직

빗썸일 때 totalCryptoCount가
“현재 필터링된 premium rows 개수”를 그대로 쓰고 있다면,
foreign join/filter에 따라 계속 변하게 됩니다.

→ 반드시 “선택된 국내 거래소에 상장된 distinct 심볼 수” 를 기준으로 계산되도록 수정 부탁드립니다.

4) 요청 요약

빗썸 KRW/BTC 마켓 전체를 기준으로 유니버스를 다시 잡아주세요.

해외 거래소는 이 유니버스에 가격을 붙이는 역할만 하도록.

빗썸 유니버스에 포함된 심볼은, 해외 시세가 없어도 항상 행이 살아 있어야 합니다.

국내 현재가만 있어도 row 유지, 해외는 - 표기.

암호화폐 총 N개 값은 해외 거래소를 바꿔도 변하지 않도록,
빗썸 유니버스 기준으로 고정해 주세요.

빗썸 USDT 마켓이 실제로 없기 때문에,
코드상 BITHUMB_USDT 축을 전제로 한 부분이 있다면 모두 제거/무시해 주세요.

이렇게 수정해주시면,

업비트 / 코인원처럼 빗썸도
국내 상장 코인 개수와 국내 현재가가 안정적으로 표시되고,

해외 거래소는 “붙는 만큼만 붙는 구조”가 될 것으로 기대합니다.