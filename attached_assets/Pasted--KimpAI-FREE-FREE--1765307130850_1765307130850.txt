[전달문] — KimpAI FREE 텔레그램 알림 최종 수정 지시서
🎯 목표

FREE 채널 알림을 “진짜 데이터 기반 시그널 요약”만 보내는 구조로 변경

가짜/랜덤 “패턴 성공률, 예상 변동폭” 완전 제거

GPT / AI 해석은 PRO에서만 사용, FREE에선 절대 사용 금지

탑50 알트에서 “급등 / 급락 / 변동성 확대”만 골라서 최대 3개 발송

조건을 만족하지 않으면 아무 알림도 보내지 않음 (노 스팸)

현재가/거래량/가격 변화/스프레드/펀딩율이 모두 kimpai.io 실시간 파이프라인( premiumTable.json, prices.json, marketStats.json ) 기준으로 정확하게 나오도록 수정

FREE 메시지 텍스트를 아래 “최종 템플릿”으로 통일

1. FREE 알림 최종 템플릿 (이 형식 그대로 적용)

FREE 알림은 오로지 시그널+기본 지표 안내용으로만 사용합니다.
통계 기반 성공률 / 예상 변동폭 / 확률 같은 표현은 FREE에서 전부 삭제해주세요.

종류는 3가지 타입으로만 구분합니다:

단기 급등 감지

단기 급락 감지

변동성 확대 감지

1-1. 급등 템플릿 (price_change_1h > 0)
🚨 [KimpAI FREE] 단기 급등 감지 — {{symbol}}

💰 현재가: ₩{{current_price_krw}} / ${{current_price_usdt}}
📊 1h 거래량 변화: {{volume_change_1h}}%
📈 1h 가격 변화: {{price_change_1h}}%
🌏 국내–해외 스프레드: {{premium}}%
📉 펀딩율: {{funding_rate}}%

📡 시그널 요약
{{signal_line}}
# 예: "매수 압력이 빠르게 유입되는 구간입니다. 추격 진입보다는 눌림·조정 구간을 기다리는 편이 안전합니다."

🌐 KimpAI는 국내·해외 거래소 가격을 실시간으로 비교해
김프·변동성·거래량을 자동 분석하는 **실시간 김프 모니터링 서비스**입니다.

👉 48h 예측·목표가·손절가·시장 리스크 등의 **고급 AI 해석은**
KimpAI PRO DM에서 제공합니다.

➡️ https://kimpai.io

1-2. 급락 템플릿 (price_change_1h < 0)
🚨 [KimpAI FREE] 단기 급락 감지 — {{symbol}}

💰 현재가: ₩{{current_price_krw}} / ${{current_price_usdt}}
📊 1h 거래량 변화: {{volume_change_1h}}%
📉 1h 가격 변화: {{price_change_1h}}%
🌏 국내–해외 스프레드: {{premium}}%
📉 펀딩율: {{funding_rate}}%

📡 시그널 요약
{{signal_line}}
# 예: "단기 매도 압력이 강하게 나타나는 구간입니다. 보유 포지션의 리스크 관리가 중요한 시점입니다."

🌐 KimpAI는 국내·해외 거래소 가격을 실시간으로 비교해
김프·변동성·거래량을 자동 분석하는 **실시간 김프 모니터링 서비스**입니다.

👉 48h 예측·목표가·손절가·시장 리스크 등의 **고급 AI 해석은**
KimpAI PRO DM에서 제공합니다.

➡️ https://kimpai.io

1-3. 변동성 확대 템플릿 (위/아래 방향 혼합, 변동폭 큰 경우)
🚨 [KimpAI FREE] 변동성 확대 감지 — {{symbol}}

💰 현재가: ₩{{current_price_krw}} / ${{current_price_usdt}}
📊 1h 거래량 변화: {{volume_change_1h}}%
📈 1h 가격 변화: {{price_change_1h}}%
🌏 국내–해외 스프레드: {{premium}}%
📉 펀딩율: {{funding_rate}}%

📡 시그널 요약
{{signal_line}}
# 예: "위·아래 변동 폭이 커진 상태입니다. 레버리지·포지션 사이즈를 평소보다 줄이는 것을 권장합니다."

🌐 KimpAI는 국내·해외 거래소 가격을 실시간으로 비교해
김프·변동성·거래량을 자동 분석하는 **실시간 김프 모니터링 서비스**입니다.

👉 48h 예측·목표가·손절가·시장 리스크 등의 **고급 AI 해석은**
KimpAI PRO DM에서 제공합니다.

➡️ https://kimpai.io


중요:
FREE 템플릿에서는 아래 항목 절대 사용 금지

패턴 성공률: {{pattern_success_rate}}%

예상 변동폭: ±{{pattern_range}}%

“과거 동일 패턴에서 XX% 확률로…” 같은 문장

2. 데이터 계산 규칙 & 버그 수정
2-1. price_change_1h vs volume_change_1h 버그 수정

현재 FREE 알림에서

1h 거래량 변화와 1h 가격 변화가 동일한 값으로 찍히는 버그가 있습니다.
→ 이 부분을 반드시 분리해서 계산해주세요.

규칙:

price_change_1h
= 가격 기준 1시간 퍼센트 변화
예: ((현재가 - 1시간 전 가격) / 1시간 전 가격) * 100

volume_change_1h
= 거래량(quote 기준) 1시간 퍼센트 변화
예: ((현재 1h 거래량 - 직전 1h 거래량) / 직전 1h 거래량) * 100

실제 구현 위치:

/api/bot/alts 혹은 관련 API에서

price_change_1h는 premiumTable 혹은 prices의 가격 히스토리 기반

volume_change_1h는 marketStats 또는 1h 합산 거래량 기반으로 계산

두 값이 같은 필드를 참조하지 않도록 코드 리뷰 및 수정 필수

2-2. 현재가 표기 (KRW + USD 동시 표기)

FREE 알림 템플릿에서:

current_price_krw
→ premiumTable / prices에 있는 국내 기준 원화 가격

current_price_usdt
→ 같은 시점의 해외 USDT 가격을 KRW 환율로 나누거나,
이미 USD 기준 값이 있으면 그대로 사용
예: 해외 가격(USDT) × 1 USDT(USD) → 달러값로 표기

포맷 예:

₩30.71 / $0.023

₩138,000 / $103.2

숫자 포맷은 기존 홈 화면 포맷 함수와 최대한 통일해 주세요.

3. FREE 스캐닝 로직 (10분 주기, 최대 3개 발송)

현재 FREE 스케줄러는 TOP50을 10분마다 스캔해서 메시지를 보내고 있습니다.
이를 아래 조건으로 정리해주세요.

3-1. 대상 범위

시총 TOP 50 알트코인 (이미 구현되어 있다면 그대로 사용)

데이터 소스: kimpai.io 백엔드 API
→ /api/bot/alts?limit=50 또는 premiumTable/marketStats 기반

3-2. 시그널 분류 기준 (예시 값, 튜닝 가능)

코인마다 아래 기준을 계산:

price_change_1h

volume_change_1h

abs_price_change_1h = |price_change_1h|

premium

funding_rate

그리고 세 가지 카테고리로 분류:

급등 후보 (spikeUpList)

price_change_1h >= +5%

volume_change_1h >= +100% (직전 1h 대비 2배 이상)

급락 후보 (spikeDownList)

price_change_1h <= -5%

volume_change_1h >= +100%

변동성 확대 후보 (highVolList)

abs_price_change_1h >= 3%

volume_change_1h >= +50%

급등/급락에 이미 포함된 종목은 제외

3-3. 발송 우선순위 & 개수

10분마다 실행할 때:

spikeUpList에서 가장 price_change_1h 큰 코인 1개

spikeDownList에서 가장 price_change_1h(절대값) 큰 코인 1개

highVolList에서 abs_price_change_1h 가장 큰 코인 1개

→ 최대 3개 발송

어떤 리스트가 비어 있으면 그 타입은 건너뛰고 발송 안 함

모든 리스트가 비어 있으면 그 타임에는 FREE 알림 아무 것도 전송하지 않음

콘솔에만 [FREE Scan] No coins matched thresholds 정도로 로그

4. FREE/PRO 역할 분리 (최종)
FREE

사용하는 템플릿: 위 1번의 3종 (급등/급락/변동성)

사용하는 텍스트 변수:

current_price_krw, current_price_usdt

volume_change_1h, price_change_1h

premium, funding_rate

signal_line (룰 기반, if/else 단순 문구)

GPT / generateAiLine 절대 호출 금지

“패턴 성공률, 예상 변동폭, 과거 패턴 확률” 메세지 전부 제거

PRO

/pro_btc, /pro_whale, /pro_risk 등에서만

generateAiLine / GPT-4o-mini 사용

48h 예측, 목표가, 손절가, 리스크 분석 등 고급 문구 포함

데이터 소스는 이미 premiumTable / marketStats / prices 기반으로 설정된 상태 유지

5. 수정해야 할 주요 파일 (예상)

src/bot/schedulers/freeAltScan.js

TOP50 스캔 → 급등/급락/변동성 분류 로직 구현

10분마다 최대 3개 발송, 조건 미충족 시 발송 없음

src/bot/utils/marketData.js (또는 유사 파일)

가격/거래량/펀딩/프리미엄 계산 시,
price_change_1h와 volume_change_1h를 각각 다른 소스/필드에서 가져오도록 수정

src/bot/messages/freeTemplates.js (또는 messages 관련 파일)

FREE 템플릿을 위 3종으로 전면 교체

통계/패턴/확률 관련 필드 전부 제거

6. 테스트 체크리스트

작업 완료 후 아래를 꼭 확인해주세요.

10분 스케줄러 동작 확인

어떤 시점에는 1~3개의 FREE 알림이 오고,

시장이 조용하면 알림이 아예 안 오는지 확인

데이터 값 검증

텔레그램 FREE 알림의

현재가(₩, $)

1h 거래량 변화

1h 가격 변화

김프

펀딩율
이 값들이 kimpai.io 웹에서 같은 코인 지표와 대략 일치하는지 눈으로 비교

퍼센트 버그 재발 방지

1h 거래량 변화와 1h 가격 변화가 더 이상 항상 똑같이 찍히지 않는지 확인

FREE에 GPT 사용 여부

로그/코드 상 FREE 경로에서 generateAiLine / OpenAI 호출이 발생하지 않는지 확인

PRO 명령어 유지

/pro_btc, /pro_whale, /pro_risk 실행 시
→ GPT 기반 AI 해석이 정상 출력되는지 확인