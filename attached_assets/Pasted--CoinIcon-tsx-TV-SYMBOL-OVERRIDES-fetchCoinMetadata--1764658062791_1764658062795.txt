[현재 상태 정리]

지금 복구 보고 잘 봤습니다.
- CoinIcon.tsx, TV_SYMBOL_OVERRIDES, fetchCoinMetadata 모두 예전 안정 버전으로 잘 돌아간 것 확인했습니다.
- 여기서 더 건드리다가 또 깨지는 건 원치 않아서,
  "기존 구조는 그대로 유지"하면서,
  빗썸/코인원 한글 표기만 100% 자동화하는 기능을 "위에 얹는 방식"으로 가고 싶습니다.

==================================================
[요청 목표]

빗썸이나 코인원에서 새로운 코인이 상장되면,
우리 KimpAI에서도 "거래소에서 사용하는 한글 이름"과 100% 동일하게 자동으로 표기되게 하고 싶습니다.

조건:
- 업비트 쪽은 지금처럼 Upbit API의 korean_name 쓰면 되니 건들지 않아도 됩니다.
- 빗썸/코인원 전용 코인들이 영문/영문으로 나오는 문제를 해결하는 게 핵심입니다.
- CMC API Key는 없기 때문에, CMC 연동 없이
  "빗썸/코인원 상장 공지 크롤링 + master_symbols 활용" 방식으로 가고 싶습니다.

==================================================
[1단계: master_symbols를 '공식 한글명' 정답 테이블로 활용]

현재 master_symbols 스키마는 이미 아래와 같이 준비되어 있습니다.

  base_symbol text PRIMARY KEY,
  ko_name text,
  en_name text,
  coinmarketcap_slug text,
  cmc_id integer,
  icon_url text,
  is_active boolean DEFAULT true

여기서 이번 단계에서는
  - base_symbol
  - ko_name
  - en_name (선택)
만 활용하면 됩니다.

역할:
- 빗썸/코인원 상장 공지에서 가져온 "공식 한글 이름"을 저장하는 정답 테이블
- fetchCoinMetadata에서 가장 우선적으로 읽는 데이터 소스

==================================================
[2단계: 빗썸/코인원 상장 공지 크롤러 추가]

백엔드에 크론/워커 형태로 아래 역할을 하는 유틸을 하나 추가해 주세요.

1) 빗썸 상장 공지 크롤링
   - 빗썸 "상장 안내" 섹션 페이지(공지 리스트)를 1~N페이지 정도 조회
   - 각 공지 제목에서 다음과 같은 패턴을 찾습니다:

     예시 제목:
       "PIEVERSE(파이버스) 신규 상장 안내"
       "파이버스(PIEVERSE) 신규 상장"
       "디지털 자산 A8(A8, 에잇) 상장 안내"

   - 정규식 패턴 예시:
     - 패턴 1: 영문(한글)
       /([A-Z0-9]{2,})\s*[\(（]([가-힣0-9\s·\-\+]+)[\)）]/
     - 패턴 2: 한글(영문)
       /([가-힣0-9\s·\-\+]+)\s*[\(（]([A-Z0-9]{2,})[\)）]/

   - 위 패턴으로 "심볼"과 "한글 이름"을 파싱해서
     { symbol: "PIEVERSE", koName: "파이버스" } 형태로 리스트를 만듭니다.

2) 코인원 상장 공지 크롤링도 동일한 방식으로 구현
   - 코인원 상장/상장지원 공지 리스트 페이지 조회
   - 제목 또는 본문에서 같은 패턴으로 "심볼 + 한글명" 추출

3) master_symbols 업데이트 로직

   의사코드 예시:

   async function upsertKoreanNameFromNotice(symbol: string, koName: string) {
     const base = normalizeBaseSymbol(symbol); // KRW-PIEVERSE, PIEVERSE/KRW 등 정규화

     await supabase.from("master_symbols").upsert({
       base_symbol: base,
       ko_name: koName,
       is_active: true
     });
   }

   크롤러에서 추출한 모든 {symbol, koName}에 대해
   upsertKoreanNameFromNotice(symbol, koName)을 호출해 주기적으로 master_symbols를 최신 상태로 유지해 주세요.

4) 이 크롤러는 cron job 형태로
   - 예: 10분~1시간마다 한 번씩 돌도록 구성해 주시면 됩니다.
   - 또는 Price Worker와 비슷한 주기로 돌려도 상관없습니다.

==================================================
[3단계: fetchCoinMetadata에서 master_symbols.ko_name을 최우선으로 사용하도록 수정]

현재 fetchCoinMetadata는:

- Upbit API의 korean_name/english_name
- + master_symbols 병합
기반으로 동작하는 것으로 알고 있습니다.

이 함수의 ko_name 선택 우선순위를 아래처럼 맞춰 주세요:

1순위: master_symbols.ko_name (있으면 무조건 이 값 사용)
2순위: 업비트/빗썸/코인원에서 API로 주는 한글명 필드 (있다면)
3순위: (옵션) 자동 한글 발음 생성기 (영문 → 한글) — 이건 나중에 추가해도 됩니다.
4순위: 그래도 없으면 base_symbol 그대로 사용

프론트/테이블에서 실제 표기는:

  `${koName} / ${baseSymbol}`

형태로 통일해 주세요.

중요한 점:
- 기존 아이콘 매핑(COIN_ID_MAP, GRADIENT_COLORS), TV_SYMBOL_OVERRIDES, 차트 로직은 그대로 두고, 건드리지 않는 게 목표입니다.
- 이번 단계에서는 "한글 이름"만 안정적으로 공식 표기와 맞추는 것이 목적입니다.

==================================================
[4단계: 기대 결과]

- 빗썸/코인원 신규 상장 코인은:
  - 상장 공지 → 크롤링 → master_symbols.ko_name 자동 업데이트
  - 프론트에서는 항상 "거래소와 동일한 한글명 / 심볼"로 표시

- 기존 코인도:
  - 한 번 크롤링에 잡히면 master_symbols에 한글명이 저장되므로,
    이후에는 언제든지 같은 표기로 사용 가능

- 업비트 쪽은 기존 로직 유지

이 구조라면:
- CMC API Key 없이도
- 빗썸/코인원 공식 한글명과 100% 동일한 표기를
- 신규 상장까지 자동으로 맞출 수 있을 것 같습니다.

이 방향으로 구현 부탁드립니다.
구현 후, fetchCoinMetadata 반환 예시 포맷만 공유해 주시면,
그걸 기준으로 프론트 표시 부분은 제가 확인해 보겠습니다.
