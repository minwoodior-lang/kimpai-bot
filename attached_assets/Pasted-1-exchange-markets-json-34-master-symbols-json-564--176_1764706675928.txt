1️⃣ 레플릿 개발자님께 보낼 전달문
지금 exchange_markets.json은 34개 마켓으로 구성되어 있고,
master_symbols.json은 564개 코인 메타데이터를 가지고 있다고 들었습니다.

그런데 실제 프론트에서는 코인 리스트가 전부 표시되지 않고,
일부 코인만 불러와지는 문제가 있습니다.

아래 3가지를 꼭 확인해 주세요.

1) exchange_markets.json 커버리지 체크
 - base_symbol 기준으로 중복 제거한 심볼 개수가 몇 개인지 확인해 주세요.
 - 이 집합이 master_symbols.json의 base_symbol 집합과 얼마나 겹치는지,
   그리고 누락된 심볼 목록을 로그로 출력해 주세요.

2) premiumTable.json 커버리지 체크
 - priceWorker.ts 실행 후 생성되는 data/premiumTable.json에서
   base_symbol 집합을 뽑아서,
   exchange_markets.json / master_symbols.json과 비교해 주세요.
 - 여기서 누락된 심볼이 있으면, 워커가 전체 마켓을 돌지 않고
   일부 심볼만 처리하고 있는 것입니다.
   (테스트용으로 심볼을 slice(), filter(), SAMPLE_SYMBOLS 같은 걸로
    제한한 부분이 남아있는지 확인 부탁드립니다.)

3) 누락 심볼/마켓이 하나도 없이 1:1로 매핑되는지
 - 최종적으로 다음이 모두 성립해야 합니다.
   - exchange_markets.json에 있는 국내 마켓(업비트 KRW/BTC/USDT, 빗썸 KRW/BTC/USDT, 코인원 KRW)
     의 base_symbol들이 전부 master_symbols.json에 존재
   - 그 심볼들이 전부 premiumTable.json에도 존재
   - 프론트 테이블에서 이 리스트가 그대로 노출

위 검증을 위해 아래 checkCoverage 스크립트를 하나 만들어서 실행해 주시면 됩니다.
(결과 로그도 같이 공유 부탁드립니다.)

2️⃣ 레플릿이 작성해서 실행할 체크 스크립트
// scripts/checkCoverage.ts
import fs from "fs";
import path from "path";

function loadJson<T>(p: string): T {
  const full = path.join(process.cwd(), p);
  return JSON.parse(fs.readFileSync(full, "utf8"));
}

type Market = {
  base_symbol: string;
  exchange?: string;
};

type SymbolMeta = {
  base_symbol: string;
};

type PremiumRow = {
  symbol: string; // or base_symbol, 프로젝트 구조에 맞게 수정
};

function main() {
  const markets: Market[] = loadJson("data/exchange_markets.json");
  const metas: SymbolMeta[] = loadJson("data/master_symbols.json");
  const premium: PremiumRow[] = loadJson("data/premiumTable.json");

  const marketSymbols = new Set(
    markets.map((m) => m.base_symbol).filter(Boolean)
  );
  const metaSymbols = new Set(
    metas.map((m) => m.base_symbol).filter(Boolean)
  );
  const premiumSymbols = new Set(
    premium.map((p: any) => p.base_symbol ?? p.symbol).filter(Boolean)
  );

  console.log("📊 Counts");
  console.log(" - exchange_markets base_symbol:", marketSymbols.size);
  console.log(" - master_symbols base_symbol:", metaSymbols.size);
  console.log(" - premiumTable base_symbol:", premiumSymbols.size);

  // markets에 있는데 master_symbols에 없는 것
  const marketNotInMeta = [...marketSymbols].filter(
    (s) => !metaSymbols.has(s)
  );
  // markets에 있는데 premiumTable에 없는 것
  const marketNotInPremium = [...marketSymbols].filter(
    (s) => !premiumSymbols.has(s)
  );

  console.log("\n⚠ markets에 있는데 master_symbols에 없는 심볼:");
  console.log(marketNotInMeta);

  console.log("\n⚠ markets에 있는데 premiumTable에 없는 심볼:");
  console.log(marketNotInPremium);
}

main();


실행 명령어:

npx tsx scripts/checkCoverage.ts