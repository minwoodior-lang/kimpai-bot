[레플릿 개발팀 전달용 메세지]

안녕하세요, 상세한 옵션 설명 감사합니다.
우선은 MVP 단계에서 가격/김프 히스토리 구축이 중요하다고 판단해서,
다음과 같이 진행을 부탁드립니다.

✅ 1) 방식 선택: Scheduled Deployment (1분 간격)

Replit의 Scheduled Deployment를 사용해서
1분마다 price_snapshots 테이블을 업데이트하는 스크립트를 실행하는 방식으로 진행해 주세요.

지금은 1분 주기면 충분합니다.
(향후 트래픽/유료 플랜에 따라 Always-on VM으로 5초 간격까지 확장 예정)

✅ 2) updatePrices 스크립트 생성

파일 예시 위치

scripts/updatePrices.ts
혹은 팀에서 선호하는 위치에 생성하셔도 됩니다.

스크립트에서 해주셨으면 하는 작업

대상 심볼

현재 Markets/홈에서 사용하는 코인들 기준:

BTC/KRW, ETH/KRW, XRP/KRW, SOL/KRW, ADA/KRW, DOGE/KRW, AVAX/KRW

추후 심볼 추가 시 확장 가능하게 배열로 관리해 주시면 좋겠습니다.

업비트 가격 조회

업비트 공개 API에서 각 심볼의 KRW 가격 조회
(예: /v1/ticker?markets=KRW-BTC,KRW-ETH,...)

바이낸스(or 사용 중인 해외 거래소) USD/USDT 가격 조회

동일 심볼의 USDT/USDT 가격을 가져옵니다.
(예: BTCUSDT, ETHUSDT 등)

USD/KRW 환율 조회

현재 useMarkets에서 사용하는 방식과 동일한 소스를 사용해 주세요.

예: 별도 환율 API, 또는 USD/KRW 마켓을 이용한 환산 등.

김프 계산 로직 (예시)
심볼별로 아래 값을 계산해 주세요.

upbitPriceKrw     // 업비트 KRW 가격
binancePriceUsd   // 바이낸스 USD/USDT 가격
fxRate            // 1 USD당 KRW
binancePriceKrw = binancePriceUsd * fxRate

premiumPercent = (upbitPriceKrw / binancePriceKrw - 1) * 100


가능하다면 24h 거래량, 24h 변동률(%)도 같이 계산해서 넣어주시면
이미 markets.tsx에서 쓰는 UI와 자연스럽게 맞을 것 같습니다.

price_snapshots 테이블에 저장

각 심볼별로 한 행씩 insert 해 주세요.

필요한 컬럼 예시 (현재 /api/premium/table에서 사용하는 구조에 맞춰 주세요):

{
  symbol: string,
  upbit_price: number,
  binance_price_usd: number,
  fx_rate: number,
  premium: number,        // %
  volume_24h?: number | null,
  change_24h?: number | null,
  created_at: timestamptz (now)
}


정확한 컬럼명은 지금 price_snapshots / /api/premium/table에서 사용 중인 스키마에 맞춰 주시면 됩니다.
중요한 것은 심볼 / 업비트 가격 / 해외 가격 / 환율 / 김프 / 타임스탬프가 포함되는 것입니다.

✅ 3) /api/premium/table → 최신 스냅샷 참조하도록 조정

현재 /api/premium/table은 mock 데이터를 반환하고 있는데,
이를 price_snapshots에서 “가장 최근 created_at 기준 심볼별 최신 한 건씩” 가져오는 쿼리로 변경해 주세요.

예시 개념:

심볼별로 ORDER BY created_at DESC LIMIT 1

또는 created_at = (SELECT max(created_at) FROM price_snapshots) 조건으로 조회

그리고 useMarkets에서 사용 중인:

averagePremium

fxRate

updatedAt
값도 이 쿼리 결과를 기준으로 계산해 주시면 됩니다.

✅ 4) 주기 관련

Scheduled Deployment는 1분 간격으로 설정해 주세요.

cron 예: * * * * *

이후 FREE/PRO 플랜에서 “5초/30초”와 같은 속도 차별화가 필요해지면,
그때는 Always-on VM 방식이나 별도 인프라로 확장 요청을 드리겠습니다.

작업이 완료되면:

/ (홈)과 /markets에서

가격/김프가 실제 시세 기준으로 갱신되는지

업데이트 시간(updatedAt)이 1분 단위로 변하는지

/api/premium/table 응답 구조가 바뀌었을 경우

useMarkets 훅과의 타입/필드 매칭이 정상인지

정도만 한 번 확인 부탁드립니다.

감사합니다! 🙏