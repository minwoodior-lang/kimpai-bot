[레플릿 개발팀 전달용]

안녕하세요.
현재 멀티 거래소 선택 UI 및 차트 전환 기능까지 잘 구현해 주신 것 확인했습니다.
감사합니다 🙏

지금 상태에서는 UI 상으로는 국내/해외 거래소를 자유롭게 바꿀 수 있지만,
실제 김프 계산과 테이블 데이터는 여전히 업비트 + 바이낸스 고정인 상태입니다.

다음 단계로, 아래와 같이 백엔드 멀티 거래소 지원을 확장하고 싶습니다.

1) 새 테이블(또는 등가 구조) 도입 – exchange_prices
create table if not exists public.exchange_prices (
  id bigserial primary key,
  exchange text not null,       -- UPBIT, BITHUMB, COINONE, BINANCE, OKX ...
  symbol text not null,         -- BTC, ETH, XRP ...
  base text not null,           -- BTC, ETH ...
  quote text not null,          -- KRW, USDT, BTC ...
  price numeric not null,       -- 현재 가격
  price_krw numeric not null,   -- fx_rate 반영한 KRW 기준 가격
  volume_24h numeric,
  change_24h numeric,
  created_at timestamptz default now()
);
create index on public.exchange_prices(exchange, symbol, quote, created_at desc);


목적: 어떤 국내/해외 거래소 조합이든
price_krw 기준으로 김프를 계산할 수 있게 만드는 저장소입니다.

기존 price_snapshots 테이블은
“대표 조합(업비트 vs 바이낸스)” 요약용이나 캐시용으로 유지하셔도 됩니다.

2) Price Worker 확장 – 멀티 거래소 가격 수집

현재 priceWorker.ts 가 업비트 + 코인게코 기준으로
price_snapshots를 갱신하고 있는 것으로 알고 있습니다.

이 워커를 확장하여 아래 거래소의 현재가 + 24h 거래량 + 변동률을
exchange_prices 테이블에 5초 간격으로 저장하는 구조로 확장해 주실 수 있을까요?

국내: Upbit, Bithumb, Coinone

해외: Binance, OKX, Bybit, Bitget, Gate, HTX, MEXC

각 거래소마다 fetchUpbit(), fetchBithumb() 같은 함수를 두고,
5초마다 Promise.all([...]) 로 병렬 업데이트하는 방식이면 좋겠습니다.

3) /api/premium/table 엔드포인트 파라미터화

현재는 업비트+바이낸스 고정으로 동작하는데,
아래와 같이 쿼리 파라미터를 받아들일 수 있도록 확장 부탁드립니다.

// 예시: /api/premium/table?domestic=UPBIT_KRW&foreign=BINANCE_USDT
domestic = 'UPBIT_KRW';
foreign = 'BINANCE_USDT';


엔드포인트 내부 로직은:

domestic, foreign 문자열을 파싱해

국내: exchange + quote (예: UPBIT + KRW)

해외: exchange + quote (예: BINANCE + USDT)

exchange_prices 테이블에서 가장 최근 레코드를 가져와
동일 심볼 기준으로 매칭

price_krw 값을 사용해서 김프를 계산

premium = (domestic.price_krw - foreign.price_krw) / foreign.price_krw * 100;


기존 /api/premium/table 이 반환하던 JSON 포맷을 유지하되,
계산 기준만 선택된 거래소 조합으로 변경

4) 프론트 훅(useMarkets) 과 연동

프론트 쪽에서는 useMarkets() 훅에
현재 선택된 국내/해외 거래소 코드를 넘겨주도록 사용할 예정입니다.

const { data, ... } = useMarkets({
  domestic: selectedDomestic,  // 예: 'UPBIT_KRW'
  foreign: selectedForeign,    // 예: 'BINANCE_USDT'
});


Home, /markets, /markets/[symbol] 모두
이 동일 훅과 API를 바라보도록 연결하면 됩니다.

이 작업이 완료되면:

홈 / 마켓 리스트 / 상세 페이지에서
국내·해외 거래소 조합을 바꿀 때마다
차트 + 김프 테이블 + 요약 값이 전부 해당 조합 기준으로 즉시 갱신되게 됩니다.

작업 가능 여부와, 필요하다면 더 적절한 스키마/구조에 대한 제안도 부탁드립니다. 🙏
감사합니다!