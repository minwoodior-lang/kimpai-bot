[ì „ë‹¬ë¬¸] KimpAI ê°€ê²© ìˆ˜ì§‘ êµ¬ì¡° ê°œí¸ â€“ WS ìµœì†Œí™” & ë¹„ìš© ì ˆê° êµ¬ì¡° ì „í™˜

ì•„ë˜ ì‘ì—…ë“¤ì„ ìˆœì„œëŒ€ë¡œ ì ìš©í•´ì£¼ì„¸ìš”.

ğŸŸ¥ 1. Render ì„œë²„(kimpai-price-proxy) â€“ Binance ì™¸ í•´ì™¸ WebSocket ì „ë¶€ ë¹„í™œì„±í™”

Render ì„œë²„ëŠ” ë©”ëª¨ë¦¬Â·ëŒ€ì—­í­ í•œê³„ë¡œ ì¸í•´
Binance Spot / Binance Futures WebSocket ë‘ ê°œë§Œ ìœ ì§€í•©ë‹ˆë‹¤.

ì•„ë˜ ì‘ì—…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.

âœ… ìˆ˜ì • ì§€ì‹œì‚¬í•­
(1) src/index.ts ë˜ëŠ” WSë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì—”íŠ¸ë¦¬ íŒŒì¼ì—ì„œ

ì•„ë˜ í•¨ìˆ˜ëŠ” ìœ ì§€í•©ë‹ˆë‹¤:

startBinanceSpotWs();
startBinanceFuturesWs();

(2) ì•„ë˜ ëª¨ë“  WebSocket ìŠ¤íƒ€íŠ¸ í•¨ìˆ˜ëŠ” ì „ë¶€ ì£¼ì„ ì²˜ë¦¬ ë˜ëŠ” ì‚­ì œí•´ì£¼ì„¸ìš”:
startBybitWs();
startOkxWs();
startGateWs();
startMexcWs();
startBitgetWs();
startHtxWs();

(3) Render ë¡œê·¸ì—ì„œ ë” ì´ìƒ ì•„ë˜ê°€ í‘œì‹œë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤:
WS-MEXC ì—°ê²°ë¨
WS-Bybit ì—°ê²°ë¨
WS-OKX ì—°ê²°ë¨
WS-Gate ì—°ê²°ë¨
WS-Bitget ì—°ê²°ë¨
WS-HTX ì—°ê²°ë¨


â†’ í‘œì‹œë˜ë©´ ì•ˆ ë¨. Binance Spot/Futuresë§Œ ë‚¨ê²¨ì•¼ í•¨.

ğŸŸ¦ 2. Replit ì„œë²„ â€“ í•´ì™¸ ê±°ë˜ì†ŒëŠ” REST ê¸°ë°˜ ê°€ê²© ìˆ˜ì§‘ìœ¼ë¡œ ì „í™˜

Renderì—ì„œ ì œê±°í•œ WebSocket ê¸°ëŠ¥ì„
Replit ì›Œì»¤ê°€ REST 2~3ì´ˆ polling ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ ì†ë„ ì¶©ë¶„, ë¶€í•˜ ìµœì†Œ, ê³¼ê¸ˆ ë°©ì§€ êµ¬ì¡°ì…ë‹ˆë‹¤.

ğŸ”µ (1) ë‹¤ìŒ fetcher íŒŒì¼ì„ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸ í•´ì£¼ì„¸ìš”:

í´ë”: workers/fetchers/

bybit.ts

okx.ts

gate.ts

mexc.ts

(ìˆìœ¼ë©´ ì¶”ê°€: bitget.ts, htx.ts)

ğŸ”µ (2) ê° fetcher ë‚´ë¶€ì—ì„œ ë‹¤ìŒì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
âœ” 24ì‹œê°„ ê°€ê²© / í˜„ì¬ê°€ / ê±°ë˜ëŸ‰ì„ ì–»ëŠ”

ê³µê°œ REST ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
(ì˜ˆ: ticker/24h ë˜ëŠ” markets/ticker)

âœ” ì‘ë‹µì„ ë‚´ë¶€ ê³µí†µ íƒ€ì… PriceEntryë¡œ ë§¤í•‘
âœ” prices.jsonì— merge ì €ì¥
âœ” ìš”ì²­ ì£¼ê¸°: 2ì´ˆ~3ì´ˆ ê°„ê²©

ì˜ˆì‹œ í•¨ìˆ˜ í˜•íƒœ:

export async function fetchBybitPrices() {
  const res = await fetch("https://api.bybit.com/v5/market/tickers?category=spot");
  const data = await res.json();
  // ë³€í™˜ â†’ PriceEntry
  saveToPricesJson(parsedEntries);
}

ğŸŸ¦ 3. Replit priceWorkerì—ì„œ ëª¨ë“  REST fetcherë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í˜¸ì¶œí•˜ë„ë¡ êµ¬ì„±

íŒŒì¼: workers/priceWorker.ts ë˜ëŠ” ë©”ì¸ ì›Œì»¤ íŒŒì¼

ì•„ë˜ í•¨ìˆ˜ë“¤ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”:
setInterval(async () => {
  await fetchUpbitPrices();
  await fetchBithumbPrices();
  await fetchCoinonePrices();

  await fetchBybitPrices();
  await fetchOkxPrices();
  await fetchGatePrices();
  await fetchMexcPrices();
  // í•„ìš” ì‹œ bitget, htx ì¶”ê°€
}, 2000);


â†’ 2ì´ˆ ê¸°ì¤€ ì¶”ì²œ

ğŸŸ© 4. Replitì—ì„œ WebSocketì´ í•„ìš”í•  ê²½ìš° ë‹¨ 1~2ê°œ ì‹¬ë³¼ë§Œ ìœ ì§€ (ì„ íƒ ì‚¬í•­)

ì†ë„ ê°œì„ ì´ í•„ìš”í•˜ê±°ë‚˜ íŠ¹ì • ì§€í‘œ(Kimp score ë“±)ì—ë§Œ WSê°€ í•„ìš”í•˜ë‹¤ë©´:

Replitì—ì„œ Bybit BTCUSDT / ETHUSDT ì •ë„ë§Œ WebSocket ì¶”ê°€

ë‚˜ë¨¸ì§€ ì½”ì¸ì€ ëª¨ë‘ RESTë¡œ ìœ ì§€

â¡ ì‹œìŠ¤í…œ ì•ˆì •ì„±ê³¼ ëŒ€ì—­í­ ì ˆì•½ ê·¹ëŒ€í™”.

ğŸŸ§ 5. ìµœì¢… ëª©í‘œ êµ¬ì¡°
[Render Proxy]
 â”œâ”€ Binance Spot WS (ìœ ì§€)
 â””â”€ Binance Futures WS (ìœ ì§€)

[Replit Main Server]
 â”œâ”€ Upbit/Bithumb/Coinone (REST)
 â”œâ”€ Bybit/OKX/Gate/MEXC/Bitget/HTX (REST 2ì´ˆ)
 â”œâ”€ (ì„ íƒ) Bybit BTC/ETH WebSocketë§Œ ì‚¬ìš©
 â”œâ”€ prices.json / premiumTable.json ìƒì„±
 â””â”€ í”„ë¡ íŠ¸/í…”ë ˆë´‡/Kimp ê³„ì‚° ì²˜ë¦¬

ğŸ§¨ ê¸°ëŒ€ íš¨ê³¼ (ì¤‘ìš”)

Render ëŒ€ì—­í­ 80~90% ê°ì†Œ

Render ë©”ëª¨ë¦¬ í­ë°œ(OOM) ì‚¬ë¼ì§

Replitì€ í˜„ì¬ ê¸°ì¤€ 100GB ë¬´ë£Œ ì•ˆì—ì„œ ì¶©ë¶„íˆ ìš´ì˜ ê°€ëŠ¥

ì†ë„ ì²´ê°ì€ ë°”ì´ë‚¸ìŠ¤ WS ë•Œë¬¸ì— ê±°ì˜ ë™ì¼

ì „ì²´ ë¹„ìš© ìµœëŒ€ ì ˆë°˜ ì´í•˜ë¡œ ì ˆê°