ğŸ“Œ ì „ë‹¬ë¬¸: ì½”ì¸í…Œì´ë¸” êµ­ë‚´/í•´ì™¸ í˜„ì¬ê°€ + ê¹€í”„ ë¡œì§ ì „ë©´ ì •ë¦¬
ë³€ê²½ ë²”ìœ„

í”„ë¡ íŠ¸

src/components/TwoLinePriceCell.tsx

src/components/PremiumTable.tsx (í‘œì‹œë¶€ë§Œ)

ë°±ì—”ë“œ

src/pages/api/premium/table-filtered.ts

âŒ workers/, websocket, data/*.json ì€ ì ˆëŒ€ ìˆ˜ì •í•˜ì§€ ë§ ê²ƒ

1ï¸âƒ£ êµ­ë‚´ í˜„ì¬ê°€ í‘œê¸° â€“ â€œì˜ˆì „ì²˜ëŸ¼ + ìˆ«ì ì ˆëŒ€ ì•ˆ ì˜ë¦¬ê²Œâ€
A. êµ­ë‚´ í˜„ì¬ê°€ í¬ë§· ì „ìš© í•¨ìˆ˜ ì¶”ê°€ (TwoLinePriceCell.tsx)
export function formatKrwDomestic(value: number | null | undefined): string {
  if (value === null || value === undefined || Number.isNaN(value)) return "-";

  const abs = Math.abs(value);

  // 1,000ì› ì´ìƒ: ì •ìˆ˜ë§Œ (ê¹€í”„ê°€ ìŠ¤íƒ€ì¼)
  if (abs >= 1000) {
    return "â‚©" + new Intl.NumberFormat("ko-KR", {
      maximumFractionDigits: 0,
      minimumFractionDigits: 0,
    }).format(value);
  }

  // 1,000ì› ë¯¸ë§Œ: ê¸°ì¡´ ë™ì  ê·œì¹™ ì‚¬ìš© (ì†Œìˆ˜ì )
  return formatKrwDynamic(value, { signed: false });
}

B. êµ­ë‚´ í˜„ì¬ê°€(ìœ„ ì¤„)ì—ë§Œ ì´ í•¨ìˆ˜ ì‚¬ìš©

PremiumTable.tsx ì—ì„œ:

<TwoLinePriceCell
  topValue={row.koreanPrice}          // êµ­ë‚´ í˜„ì¬ê°€
  bottomValue={row.foreignPriceKrw}   // í•´ì™¸ í˜„ì¬ê°€ (KRW í™˜ì‚°)
  formatTop={formatKrwDomestic}       // âœ… ìƒˆ í•¨ìˆ˜ ì‚¬ìš©
  formatBottom={formatKrwDynamic}     // ê¸°ì¡´ ë™ì  í¬ë§· + ì†Œìˆ˜ì 
/>


(í•„ìš”í•˜ë©´ TwoLinePriceCellì— formatTop, formatBottom props ì¶”ê°€í•´ì„œ ìœ„ì²˜ëŸ¼ ì ìš©)

C. ìˆ«ì ì˜ë¦¼ ë°©ì§€ â€“ ì…€ ìŠ¤íƒ€ì¼ ìˆ˜ì •

TwoLinePriceCell ìƒë‹¨/í•˜ë‹¨ ìˆ«ì spanì— ë‹¤ìŒ ì¡°ê±´ì„ ë§ì¶°ì¤€ë‹¤:

text-right

whitespace-nowrap

tabular-nums

truncate/overflow-hidden ì œê±°

ìµœì†Œ í­ í™•ë³´: ì˜ˆ) min-w-[92px] ë˜ëŠ” ë” ë„“ê²Œ

ì˜ˆì‹œ:

<span className="block text-right whitespace-nowrap tabular-nums min-w-[92px] leading-tight">
  {formattedTop}
</span>


ì´ë ‡ê²Œ í•˜ë©´ BTC, ETH, SOL ê°™ì´ ìë¦¿ìˆ˜ ê¸´ ì½”ì¸ë„ ë§ˆì§€ë§‰ ìˆ«ìê¹Œì§€ ì ˆëŒ€ ì•ˆ ì˜ë¦¼.

2ï¸âƒ£ í•´ì™¸ í˜„ì¬ê°€ + ê¹€í”„ë¥¼ â€œê° ê±°ë˜ì†Œ ì¡°í•©ë§ˆë‹¤â€ ë‹¤ì‹œ ê³„ì‚°

í•µì‹¬:
/api/premium/table-filtered ì—ì„œ ì¿¼ë¦¬ë¡œ ë°›ì€ domestic/foreign ê°’ì„ ì‹¤ì œ ê³„ì‚°ì— ë°˜ì˜í•´ì„œ,
ê° ì¡°í•©ë§ˆë‹¤ ë‹¤ë¥¸ ê¹€í”„/í•´ì™¸ê°€ê°€ ë‚˜ì˜¤ë„ë¡ ë§Œë“ ë‹¤.

A. ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ìˆ˜ì‹ 
const domesticKey = (req.query.domestic as string) || "UPBIT_KRW";
const foreignKey  = (req.query.foreign as string)  || "BINANCE_USDT";


ì˜ˆì‹œ ì¡°í•©

UPBIT_KRW + BINANCE_USDT

UPBIT_KRW + BINANCE_FUTURES

UPBIT_KRW + OKX_USDT

BITHUMB_KRW + BINANCE_USDT

COINONE_KRW + BINANCE_USDT

â€¦ í•„ìš” ì‹œ í™•ì¥

B. ë§ˆì¼“ í‚¤ ë§¤í•‘ í•¨ìˆ˜ ì •ì˜
function getDomesticMarketKey(symbol: string, domesticKey: string): string | null {
  switch (domesticKey) {
    case "UPBIT_KRW":
      return `UPBIT:${symbol}:KRW`;
    case "BITHUMB_KRW":
      return `BITHUMB:${symbol}:KRW`;
    case "COINONE_KRW":
      return `COINONE:${symbol}:KRW`;
    default:
      return null;
  }
}

function getForeignMarketKey(symbol: string, foreignKey: string): string | null {
  switch (foreignKey) {
    case "BINANCE_USDT":
      return `BINANCE:${symbol}:USDT`;
    case "BINANCE_FUTURES":
      return `BINANCE_FUTURES:${symbol}:USDT`;
    case "OKX_USDT":
      return `OKX:${symbol}:USDT`;
    // í•„ìš”í•˜ë©´ BYBIT_USDT, GATE_USDT ë“± ì¶”ê°€
    default:
      return null;
  }
}

C. êµ­ë‚´/í•´ì™¸ í˜„ì¬ê°€ ë¡œë”© ë° KRW í™˜ì‚°
const prices = loadPricesJson();          // ê¸°ì¡´ ë¡œë”© ê·¸ëŒ€ë¡œ ì‚¬ìš©
const fxRate = fx.usdKrw;                 // 1 USDT â‰ˆ ? KRW
const btcKrw = stats.btcKrw;              // BTC â†’ KRW í™˜ì‚°ê°’ (ìˆìœ¼ë©´ ì‚¬ìš©)

...

const domesticMarketKey = getDomesticMarketKey(symbol, domesticKey);
const foreignMarketKey  = getForeignMarketKey(symbol, foreignKey);

const domestic = domesticMarketKey ? prices[domesticMarketKey] : null;
const foreign  = foreignMarketKey  ? prices[foreignMarketKey]  : null;

const koreanPrice = domestic?.price ?? null;

let foreignPriceKrw: number | null = null;

if (foreign?.price != null) {
  if (foreignKey.endsWith("_USDT")) {
    foreignPriceKrw = foreign.price * fxRate;
  } else if (foreignKey.endsWith("_BTC")) {
    foreignPriceKrw = foreign.price * btcKrw;
  }
}


í•´ì™¸ ë§ˆì¼“ì´ ì—†ìœ¼ë©´ foreignPriceKrw = null ë¡œ ë‘ê³ , í”„ë¡ íŠ¸ì—ì„œëŠ” "-" í‘œì‹œ.

ì´ì œ ë“œë¡­ë‹¤ìš´ì—ì„œ foreignKeyë§Œ ë°”ë€Œë©´ í•´ì™¸ê°€/ê¹€í”„ê°€ ì „ë¶€ ë‹¬ë¼ì§„ë‹¤.

D. ê¹€í”„ % + ê¹€í”„ ì°¨ì•¡ ê³„ì‚° (ì¡°í•©ë³„ë¡œ ë…ë¦½)
let premiumDiffKrw: number | null = null;
let premiumRate: number | null = null;

if (koreanPrice != null && foreignPriceKrw != null && foreignPriceKrw > 0) {
  premiumDiffKrw = koreanPrice - foreignPriceKrw;
  premiumRate    = (premiumDiffKrw / foreignPriceKrw) * 100;
}


ì‘ë‹µ rowì—:

{
  ...,
  koreanPrice,       // êµ­ë‚´ í˜„ì¬ê°€ (ìœ—ì¤„)
  foreignPriceKrw,   // í•´ì™¸ í˜„ì¬ê°€ KRW (ì•„ë«ì¤„)
  premiumRate,       // ê¹€í”„ %
  premiumDiffKrw,    // ê¹€í”„ ì°¨ì•¡ (ì›)
}


í”„ë¡ íŠ¸ì—ì„œëŠ”:

ìœ„ì¤„: formatKrwDomestic(koreanPrice)

ì•„ë«ì¤„: formatKrwDynamic(foreignPriceKrw)

ê¹€í”„%: formatPercent(premiumRate)

ê¹€í”„ ì°¨ì•¡: formatKrwDynamic(premiumDiffKrw, { signed: true })

ë§Œ ì¨ì£¼ë©´ ëœë‹¤.

3ï¸âƒ£ ì†Œìˆ«ì  ì²˜ë¦¬(í•´ì™¸ê°€ + ì°¨ì•¡) â€“ ê¹€í”„ê°€ ìŠ¤íƒ€ì¼ë¡œ ìµœì¢… ì •ë¦¬

formatKrwDynamic ì€ ì§€ê¸ˆ ê·œì¹™ì„ ìœ ì§€í•˜ë˜,
ë’¤ì— ë¶™ëŠ” 0ë§Œ ì œê±°í•´ì„œ ê¹”ë”í•˜ê²Œ ë§Œë“ ë‹¤.

export function formatKrwDynamic(
  value: number | null | undefined,
  options: { signed?: boolean } = {}
): string {
  const { signed = false } = options;

  if (value === null || value === undefined || Number.isNaN(value)) return "-";

  const abs = Math.abs(value);
  let decimals = 0;

  if (abs >= 1000) decimals = 0;
  else if (abs >= 1) decimals = 2;
  else if (abs >= 0.1) decimals = 3;
  else if (abs >= 0.01) decimals = 4;
  else if (abs >= 0.001) decimals = 5;
  else decimals = 6; // ì´ˆì €ê°€ ì½”ì¸ ìµœëŒ€ 6ìë¦¬

  let formatted = new Intl.NumberFormat("ko-KR", {
    minimumFractionDigits: decimals,
    maximumFractionDigits: decimals,
  }).format(abs);

  // ë 0 ì œê±° (0.010000 â†’ 0.01, 42.000 â†’ 42)
  formatted = formatted.replace(/\.?0+$/, "");

  let result = formatted;

  if (signed) {
    const sign = value > 0 ? "+" : value < 0 ? "-" : "";
    result = `${sign}â‚©${result}`;
  } else {
    result = `â‚©${result}`;
  }

  return result;
}

âœ… ê¸°ëŒ€ ê²°ê³¼

êµ­ë‚´ í˜„ì¬ê°€

BTC / ETH / SOL ê°™ì€ ê³ ê°€ ì½”ì¸:

â‚©133,901,000 ì²˜ëŸ¼ ë ìˆ«ìê¹Œì§€ ì˜¨ì „íˆ í‘œì‹œ

ë” ì´ìƒ ì˜ë ¤ì„œ â‚©133,901, ì²˜ëŸ¼ ë³´ì´ëŠ” ì¼ ì—†ìŒ

ì €ê°€ ì½”ì¸: ì˜ˆì „ì²˜ëŸ¼ ë™ì  ì†Œìˆ˜ì  ê·¸ëŒ€ë¡œ ìœ ì§€

í•´ì™¸ í˜„ì¬ê°€ / ê¹€í”„

ì—…ë¹„íŠ¸â€“ë°”ì´ë‚¸ìŠ¤ USDT, ì—…ë¹„íŠ¸â€“ë°”ì´ë‚¸ìŠ¤ ì„ ë¬¼, ì—…ë¹„íŠ¸â€“OKX â€¦
ê° ì¡°í•©ë§ˆë‹¤ ì™„ì „íˆ ë‹¤ë¥¸ ê¹€í”„/í•´ì™¸ê°€ê°€ ê³„ì‚°ë¨

ë“œë¡­ë‹¤ìš´ ë°”ê¾¸ë©´ ìˆ«ìë„ ì •í™•íˆ í•¨ê»˜ ë°”ë€œ

ê¹€í”„ê°€ì™€ ê±°ì˜ ë™ì¼í•œ ìˆ˜ì¹˜ êµ¬ì¡°

ì†Œìˆ«ì 

0.010000 â†’ 0.01, 0.00056000 â†’ 0.00056, 42.000 â†’ 42

ê¹€í”„/ì°¨ì•¡ ìˆ«ì ê¹”ë”í•˜ê²Œ í‘œê¸°