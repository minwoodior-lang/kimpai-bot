ğŸ”§ ì‘ì—… ìš”ì²­: CoinIcon.tsx ì•„ì´ì½˜ ìš°ì„ ìˆœìœ„ ìˆ˜ì • + iconUrl ì‹¤ì œ ì ìš©

í˜„ì¬ CoinIcon.tsxê°€ APIì—ì„œ ì „ë‹¬ë˜ëŠ” iconUrl ê°’ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , 
ë¬´ì¡°ê±´ /coins/SYMBOL.png ë˜ëŠ” ì™¸ë¶€ CDN ì•„ì´ì½˜ë§Œ ì‹œë„í•˜ê³  ìˆìŠµë‹ˆë‹¤.
ì´ë¡œ ì¸í•´ master_symbols.icon_url í•„ë“œê°€ ì—…ë°ì´íŠ¸ë˜ì–´ë„ í™”ë©´ì— ë°˜ì˜ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì•„ë˜ëŠ” ì™„ì„±ëœ CoinIcon.tsx ì „ì²´ ì½”ë“œì…ë‹ˆë‹¤.
ì´ ì½”ë“œë¡œ íŒŒì¼ ì „ì²´ë¥¼ êµì²´í•´ì£¼ì„¸ìš”.

ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤:

1) iconUrl (DBì—ì„œ ë°›ì€ ì‹¤ì œ ì•„ì´ì½˜ URL)
2) /coins/SYMBOL.png (ë¡œì»¬ ì•„ì´ì½˜)
3) jsdelivr CDN
4) github CDN
5) coincap CDN
6) coingecko CDN
7) cryptocompare CDN
8) ë§ˆì§€ë§‰ fallback â†’ ì•ŒíŒŒë²³ ì²« ê¸€ì ICON

ğŸ“Œ ì•„ë˜ ì½”ë“œë¡œ CoinIcon.tsx ë‚´ìš©ì„ "ì „ì²´ êµì²´" í•´ì£¼ì„¸ìš”.
-------------------------------------------------------------------------------

import React, { useEffect, useState } from "react";

interface CoinIconProps {
  symbol: string;
  size?: "sm" | "md" | "lg";
  className?: string;
  iconUrl?: string | null; // master_symbols.icon_url
}

const COIN_ID_MAP: Record<string, string> = {};
const GRADIENT_COLORS: Record<string, string> = {};

const loggedMissingIcons = new Set<string>();

function normalizeSymbol(symbol: string) {
  return symbol.replace(/[^a-zA-Z0-9]/g, "").toUpperCase();
}

export default function CoinIcon({
  symbol,
  size = "md",
  className = "",
  iconUrl,
}: CoinIconProps) {
  const normalized = normalizeSymbol(symbol);
  const lower = normalized.toLowerCase();
  const upper = normalized.toUpperCase();

  const [cdnIndex, setCdnIndex] = useState(0);
  const [hasError, setHasError] = useState(false);

  const sizeClasses = {
    sm: "w-5 h-5",
    md: "w-6 h-6",
    lg: "w-8 h-8",
  };

  const textSizes = {
    sm: "text-[8px]",
    md: "text-[10px]",
    lg: "text-xs",
  };

  // 2) ë¡œì»¬ ê¸°ë³¸ ê²½ë¡œ
  const localIcon = `/coins/${upper}.png`;

  // 3) ì•„ì´ì½˜ ì‹œë„ ìš°ì„ ìˆœìœ„
  const iconSources = [
    iconUrl && iconUrl.trim() ? iconUrl : null, // 1ìˆœìœ„: DB
    localIcon, // 2ìˆœìœ„: /public/coins/SYMBOL.png
    `https://cdn.jsdelivr.net/npm/cryptocurrency-icons@0.18.1/32/color/${lower}.png`,
    `https://raw.githubusercontent.com/spothq/cryptocurrency-icons/master/32/color/${lower}.png`,
    `https://static.coincap.io/assets/icons/${lower}@2x.png`,
    COIN_ID_MAP[upper]
      ? `https://assets.coingecko.com/coins/images/1/small/${COIN_ID_MAP[upper]}.png`
      : null,
    `https://www.cryptocompare.com/media/37746251/${lower}.png`,
  ].filter(Boolean) as string[];

  const handleError = () => {
    if (cdnIndex < iconSources.length - 1) {
      setCdnIndex((prev) => prev + 1);
    } else {
      setHasError(true);
    }
  };

  useEffect(() => {
    if (hasError && process.env.NODE_ENV === "development") {
      if (!loggedMissingIcons.has(upper)) {
        loggedMissingIcons.add(upper);
        console.warn("[CoinIcon] Missing icon for:", upper);
      }
    }
  }, [hasError, upper]);

  if (hasError) {
    return (
      <div
        className={`${sizeClasses[size]} rounded-full bg-slate-600 flex items-center justify-center text-white font-bold ${textSizes[size]} ${className}`}
      >
        {upper.charAt(0)}
      </div>
    );
  }

  return (
    <img
      src={iconSources[cdnIndex]}
      alt={upper}
      className={`${sizeClasses[size]} rounded-full ${className}`}
      onError={handleError}
      loading="lazy"
    />
  );
}

-------------------------------------------------------------------------------

ì‘ì—… ì™„ë£Œ í›„ ë°˜ë“œì‹œ í™•ì¸í•´ì•¼ í•  ê²ƒ:
1) /api/premium/table ì‘ë‹µì— icon_urlì´ ë‚˜ì˜¤ë©´ â†’ ì‹¤ì œ ë¡œê³ ê°€ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2) icon_urlì´ ì—†ëŠ” ì½”ì¸ì€ ìë™ìœ¼ë¡œ /coins/SYMBOL.png ë˜ëŠ” CDN í´ë°±ì´ ì‚¬ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
3) ê¸°ë³¸ ì›í˜• fallback(ì²« ê¸€ì)ë„ ì •ìƒ ì‘ë™í•´ì•¼ í•©ë‹ˆë‹¤.

ìœ„ ì½”ë“œë¡œ êµì²´ í›„ ì €ì¥í•˜ê³  Dev ì„œë²„ ì¬ì‹œì‘ê¹Œì§€ ì™„ë£Œí•´ì£¼ì„¸ìš”.
