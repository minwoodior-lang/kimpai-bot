KimpAI v3.3.0 작업 정리해주신 내용 잘 확인했습니다.
정규화 / 메타데이터 병합 / 408개 프리미엄 계산까지 구축해주신 점은 감사합니다.

다만, 현재 구현 상태가 제가 처음부터 요청드렸던 사양과는 중요한 부분에서 다르게 동작하고 있습니다.
기능적으로 "그럴듯하게" 돌아가는 것과는 별개로, 다음 기준을 반드시 맞춰주셔야 합니다.

────────────────────────
1) 국내 3개 거래소 코인 개수부터 정확히 맞춰야 합니다
────────────────────────

제가 원하는 기준은 다음과 같습니다.

- 업비트: 업비트에 실제로 상장된 코인 개수와 우리 시스템의 "업비트 리스트 개수"가 1:1로 정확히 일치해야 합니다.
- 빗썸: 빗썸 실제 상장 개수와 내부 데이터 개수 일치
- 코인원: 코인원 실제 상장 개수와 내부 데이터 개수 일치

지금 v3.3.0에서 말씀하신 408개는
"국내 + 해외 시세가 둘 다 있는 코인"만 필터링한 결과이고,
이건 제가 원하는 "전체 국내 상장 리스트"와는 다른 개념입니다.

제가 원하는 건:

1) **국내 거래소 전체 상장 코인 리스트**를 그대로 다 가져온다.
2) 그 위에 "해외 시세가 있는 코인만 프리미엄이 계산된다"가 올라가는 구조.

즉, 해외 시세가 없다고 해서 국내 상장 코인을 빼 버리면 안 됩니다.
프리미엄(premium)은 null 이거나 "-" 로 표시하면 되지만,
**리스트 자체에서 빠지면 안 됩니다.**

→ 요청사항:
- syncDomesticMarkets.ts 에서
  - 업비트 / 빗썸 / 코인원 각각에 대해
    "해당 거래소 기준 상장 심볼 개수"를 로그로 찍어 주세요.
  - 이 개수가 **각 거래소 공식 API 기준 상장 개수와 정확히 일치하는지** 검증해 주세요.
- premiumTable.json 은 그 위에서 “프리미엄이 계산된 코인”만 별도로 관리하되,
  “국내 전체 리스트”는 절대 줄이지 말아 주세요.

────────────────────────
2) 심볼/이름/아이콘은 예전에 Supabase에서 맞춰줬던 기준 그대로 맞춰야 합니다
────────────────────────

예전에 Supabase 쓸 때는 다음이 잘 맞아 있었습니다.

- 업비트: market/all → korean_name, english_name
- 빗썸, 코인원: 각각 API + 정규화 → master_symbols 에 ko/en 이름 저장
- 아이콘: base_symbol 기준으로 /coins/SYMBOL.png 1:1 매핑

지금 v3.3.0에서는:

- normalizeSymbol, CoinGecko 메타데이터 병합 등으로
  이름/아이콘이 "국내 거래소 기준"이 아니라
  외부 기준으로 바뀐 부분이 생긴 것으로 보입니다.

제가 원하는 건:

1) **이름/심볼/아이콘의 1차 기준은 "국내 거래소"입니다.**

   - name_ko: 최대한 업비트/빗썸/코인원에 노출되는 한글명을 우선 사용
   - name_en: 기존 master_symbols.json 에 저장되어 있던 값 우선
   - CoinGecko는 "정말 국내 쪽에 정보가 없을 때만" 보조로 사용 (override 금지)

2) master_symbols.json 에 기존에 들어있던 데이터는
   함부로 다른 외부 메타데이터로 덮어쓰지 말고 그대로 유지해 주세요.

3) 아이콘(icon_url)은 예전 기준 그대로:

   - /coins/{base_symbol}.png
   - 파일이 없을 경우에만 fallback 아이콘

→ 요청사항:
- syncMetadata.ts 에서
  - 기존 master_symbols.json 값을 최우선으로 사용
  - CoinGecko는 "null/없는 경우 채우는 용도"로만 사용
  - 이미 있는 name_ko / name_en / icon_url 을 수정하거나 덮어쓰지 말아 주세요.

────────────────────────
3) 정규화는 필요하지만, 개수와 표기는 "사람 기준"에 맞게 유지해 주세요
────────────────────────

현재 normalizeSymbol() 으로 심볼 통일을 해주신 것은 좋습니다만,
그 결과로 "표기는 깔끔한데, 실제 거래소별 개수와 안 맞는 상황"이 되면 안 됩니다.

제가 원하는 방향은:

- 내부 계산/매핑에서는 정규화(uppercase, KRW-BTC → BTC)를 사용하되,
- "표기"와 "개수"는 각 거래소 기준과 동일해야 합니다.

예를 들어:

- 업비트: 제가 보는 리스트에는 업비트에서 보이는 심볼/개수 그대로여야 하고,
- 빗썸, 코인원도 마찬가지로, 각 거래소 실제 상장 수와 동일해야 합니다.

단순히 "467개 unique symbols", "408개 premium" 같은 숫자만 볼 게 아니라,
**거래소별 상장 개수와 1:1로 맞는지**를 기준으로 검증해 주세요.

────────────────────────
4) 최종적으로 체크해야 할 것
────────────────────────

1) 업비트:
   - 공식 API 기준 상장 심볼 수와
   - 우리 시스템에서 "UPBIT용 리스트" 심볼 수가 일치하는지

2) 빗썸:
   - ALL_KRW/ALL_BTC/ALL_USDT 기준 상장 심볼 수와
   - 내부 빗썸 리스트 심볼 수 일치 여부

3) 코인원:
   - ticker?currency=all 기준 심볼 수와
   - 내부 코인원 리스트 심볼 수 일치 여부

4) premiumTable.json:
   - 국내 + 해외 시세가 모두 있는 코인만 프리미엄 계산 (이건 괜찮습니다)
   - 다만, 국내 상장 리스트에서 코인이 빠지지 않도록 구조를 분리해 주세요.

결론적으로,
지금 v3.3.0의 “정규화 + 408개 프리미엄 계산“ 구조는 기술적으로 훌륭하지만,
제가 처음 요청드렸던 스펙은

- **국내 3거래소 상장 코인 개수 1:1 일치**
- **국내 기준 KO/EN 이름 및 아이콘 유지**
- **해외 시세는 프리미엄 계산용으로만 사용 (국내 리스트를 줄이지 않음)**

이 세 가지를 최우선으로 합니다.

이 기준에 맞게 한 번 더 구조를 정리해 주시면 좋겠습니다.
