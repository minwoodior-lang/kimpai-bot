ğŸ“® Replití•œí…Œ ê·¸ëŒ€ë¡œ ë³´ë‚´ëŠ” ì „ë‹¬ë¬¸
ğŸš¨ ë¬¸ì œ ìš”ì•½

í”„ë¡ íŠ¸ì—ì„œ ë™ì¼ ì½”ì¸(ì˜ˆ: SXP, ë©€í‹°ë²„ìŠ¤ì—‘ìŠ¤)ì´ ì—¬ëŸ¬ ì¤„ë¡œ ì¤‘ë³µ í‘œì‹œë˜ê³  ìˆìŠµë‹ˆë‹¤.

ì´ëŠ” /api/premium/tableì—ì„œ ë‚´ë ¤ì£¼ëŠ” premiumTable.json ì•ˆì—
ë™ì¼í•œ (exchange, market, symbol) ì¡°í•©ì˜ rowê°€ ì—¬ëŸ¬ ë²ˆ ë“¤ì–´ê°€ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì§€ê¸ˆê¹Œì§€ â€œìƒˆ íŒŒì´í”„ë¼ì¸(664+390=1,054ë§ˆì¼“)â€ì´ë¼ê³  í•˜ì…¨ì§€ë§Œ,
ì‹¤ì œë¡œëŠ” ê¸°ì¡´ ë°ì´í„°ê°€ ì•ˆ ì§€ì›Œì¡Œê±°ë‚˜, ì›Œì»¤ê°€ ê³„ì† appendí•˜ë©´ì„œ ëˆ„ì  ì¤‘ë³µì´ ìƒê¸°ê³  ìˆëŠ” ìƒíƒœì…ë‹ˆë‹¤.

ì•„ë˜ ë„¤ ê°€ì§€ë¥¼ ë°˜ë“œì‹œ ì ìš©í•´ ì£¼ì„¸ìš”.

1ï¸âƒ£ data/exchange_markets.json, data/premiumTable.json ë‘˜ ë‹¤ ì§ì ‘ ì‚­ì œ

Replit ì½˜ì†”ì—ì„œ í”„ë¡œì íŠ¸ ì—´ê³ 

data/exchange_markets.json
data/premiumTable.json
ì´ ë‘ íŒŒì¼ ê·¸ëƒ¥ íŒŒì¼ ìì²´ë¥¼ ì‚­ì œí•´ ì£¼ì„¸ìš”.

Gitì— ì»¤ë°‹ëœ ì˜ˆì „ JSONì´ ìˆìœ¼ë©´ ê·¸ê²ƒë„ ì‚­ì œ/ì´ˆê¸°í™”í•´ ì£¼ì„¸ìš”.

ğŸ’¡ ì´ê±¸ ì•ˆ í•˜ë©´, ìŠ¤í¬ë¦½íŠ¸ê°€ ì´ì „ ë‚´ìš© ë¶ˆëŸ¬ì™€ì„œ ê±°ê¸°ì— ê³„ì† .push() í•˜ê³  ìˆì„ ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

2ï¸âƒ£ syncUpbitMarkets.tsëŠ” â€œí•­ìƒ ìƒˆ ë°°ì—´ì—ì„œ ì‹œì‘â€í•˜ê²Œ ìˆ˜ì •

ì§€ê¸ˆ í˜¹ì‹œ ì´ëŸ° ì‹ìœ¼ë¡œ ë˜ì–´ ìˆìœ¼ë©´:

const existing = JSON.parse(fs.readFileSync("data/exchange_markets.json", "utf-8"));
const all = [...existing, ...upbitRows];
fs.writeFileSync("data/exchange_markets.json", JSON.stringify(all));


ì´ê±° ì „ì²´ ì‚­ì œí•˜ê³ , ì•„ë˜ì²˜ëŸ¼ ë¬´ì¡°ê±´ ì—…ë¹„íŠ¸ ê¸°ì¤€ìœ¼ë¡œ ìƒˆë¡œ ë§Œë“œëŠ” ë°©ì‹ìœ¼ë¡œ ë°”ê¿” ì£¼ì„¸ìš”.

const upbitRows = ... // ì—…ë¹„íŠ¸ ë§ˆì¼“ì—ì„œ ë§Œë“  rows ë°°ì—´

fs.writeFileSync(
  "data/exchange_markets.json",
  JSON.stringify(upbitRows, null, 2),
  "utf-8"
);


âœ… syncUpbitMarkets.ts ì‹¤í–‰ ì‹œì  = exchange_markets.json ì™„ì „ ë¦¬ì…‹.

3ï¸âƒ£ syncBithumbMarkets.ts, syncCoinoneMarkets.tsëŠ” â€œìê¸° ê±°ë˜ì†Œ ê²ƒë§Œ êµì²´â€

ë‘ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì´ë ‡ê²Œ ë™ì‘í•´ì•¼ í•©ë‹ˆë‹¤:

const raw = fs.existsSync("data/exchange_markets.json")
  ? JSON.parse(fs.readFileSync("data/exchange_markets.json", "utf-8"))
  : [];

// 1) ê¸°ì¡´ ì¤‘ì—ì„œ ìê¸° ê±°ë˜ì†Œ ê²ƒë§Œ ì œê±°
const filtered = raw.filter((row: any) => row.exchange !== "BITHUMB"); // ë˜ëŠ” COINONE

// 2) ìƒˆë¡œ ë§Œë“  rows ì¶”ê°€
const all = [...filtered, ...bithumbRows];

fs.writeFileSync(
  "data/exchange_markets.json",
  JSON.stringify(all, null, 2),
  "utf-8"
);


âœ… ì´ë ‡ê²Œ í•´ì•¼ npx tsx scripts/syncBithumbMarkets.tsë¥¼
ì—¬ëŸ¬ ë²ˆ ëŒë ¤ë„ ì¤‘ë³µì´ ì ˆëŒ€ ìƒê¸°ì§€ ì•ŠìŠµë‹ˆë‹¤.

4ï¸âƒ£ priceWorker.tsëŠ” premiumTable.jsonì„ ì ˆëŒ€ append í•˜ì§€ ë§ê³  ë§¤ë²ˆ ìƒˆë¡œ ë§Œë“¤ ê²ƒ

ì§€ê¸ˆ ë²„ê·¸ì˜ ì§„ì§œ í•µì‹¬ì€ ì—¬ê¸°ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

ê¸ˆì§€ íŒ¨í„´ ì˜ˆì‹œ (ì´ë ‡ê²Œ ë˜ì–´ ìˆìœ¼ë©´ ë¬´ì¡°ê±´ ë°”ê¿”ì•¼ í•¨):

const old = JSON.parse(fs.readFileSync("data/premiumTable.json", "utf-8"));
const result = [...old, ...newPremiumRows];
fs.writeFileSync("data/premiumTable.json", JSON.stringify(result));


ì •ìƒ íŒ¨í„´ (í•­ìƒ ìƒˆë¡œ ê³„ì‚°í•´ì„œ ë®ì–´ì“°ê¸°):

const markets = JSON.parse(
  fs.readFileSync("data/exchange_markets.json", "utf-8")
);

// ì—¬ê¸°ì„œ markets ê¸°ì¤€ìœ¼ë¡œ premiumRows ìƒˆë¡œ ê³„ì‚°
const premiumRows = calculatePremiums(markets);

fs.writeFileSync(
  "data/premiumTable.json",
  JSON.stringify(premiumRows, null, 2),
  "utf-8"
);


ê·¸ë¦¬ê³  ì•ˆì „í•˜ê²Œ í•œ ë²ˆ ë”, premiumRows ë§Œë“¤ ë•Œ ì¤‘ë³µ í‚¤ ë°©ì§€ë„ ë„£ì–´ ì£¼ì„¸ìš”:

const seen = new Set<string>();
const deduped: any[] = [];

for (const row of premiumRows) {
  const key = `${row.domesticExchange}:${row.symbol}:${row.quoteSymbol ?? "KRW"}`;
  if (seen.has(key)) continue;
  seen.add(key);
  deduped.push(row);
}

fs.writeFileSync(
  "data/premiumTable.json",
  JSON.stringify(deduped, null, 2),
  "utf-8"
);


âœ… ì´ë ‡ê²Œ í•˜ë©´ priceWorkerë¥¼ ì—¬ëŸ¬ ë²ˆ ëŒë ¤ë„
ë™ì¼ ì½”ì¸/ê±°ë˜ì†Œ/ë§ˆì¼“ ì¡°í•©ì´ 1ë²ˆë§Œ ë‚¨ìŠµë‹ˆë‹¤.

5ï¸âƒ£ ìµœì¢… ì²´í¬ ë°©ë²• (ê°œë°œììš©)

priceWorker.ts ì‹¤í–‰ í›„, Node REPLì´ë‚˜ ì‘ì€ ìŠ¤í¬ë¦½íŠ¸ë¡œ:

const data = JSON.parse(fs.readFileSync("data/premiumTable.json", "utf-8"));
const sxp = data.filter(
  (r: any) => r.symbol === "SXP" && r.domesticExchange === "UPBIT"
);
console.log(sxp.length); // ğŸ‘‰ 1ì´ ë‚˜ì™€ì•¼ ì •ìƒ


ë©€í‹°ë²„ìŠ¤ì—‘ìŠ¤(EGLD)ë„ ë™ì¼í•˜ê²Œ í™•ì¸

1 ì´ìƒì´ë©´ OK

2 ì´ìƒì´ë©´ ì—¬ì „íˆ ì¤‘ë³µ ì²˜ë¦¬ ì œëŒ€ë¡œ ì•ˆ ëœ ê²ƒì„.