ì¢‹ì•„, ì´ì œ ì§„ì§œ ë³‘ëª©ì´ ì–´ë””ì¸ì§€ ë”± ì°í˜”ìœ¼ë‹ˆê¹Œ ì •ë¦¬í•´ì„œ í•œ ë²ˆì— ëë‚´ì.
í•´ì•¼ í•  ê±´ ë”± ë‘ êµ°ë°ì•¼.

1ë‹¨ê³„. fetchCoinMetadata()ì—ì„œ icon_urlê¹Œì§€ ë¬¶ì–´ì„œ ê°€ì ¸ì˜¤ê¸°

ì§€ê¸ˆì€ exchange_marketsì—ì„œë§Œ base_symbol, name_ko, name_enë§Œ ê°€ì ¸ì˜¤ê³  ìˆì–´ì„œ
API ì‘ë‹µì— icon_urlì´ ì ˆëŒ€ ìƒê¸¸ ìˆ˜ê°€ ì—†ì–´.

ë°©ë²•:
master_symbolsì—ì„œ icon_urlê¹Œì§€ ê°™ì´ ì½ì–´ì™€ì„œ,
exchange_markets.base_symbol ê¸°ì¤€ìœ¼ë¡œ í•©ì³ì„œ ë©”íƒ€ë§µì„ ë§Œë“œëŠ” ì‹ìœ¼ë¡œ ë°”ê¾¸ë©´ ëœë‹¤.

/app/api/premium/table/route.ts (í˜¹ì€ ì—¬ê¸°ì— ìˆëŠ” fetchCoinMetadata ì •ì˜ ìœ„ì¹˜)ì—ì„œ
ê¸°ì¡´ fetchCoinMetadata ì „ì²´ë¥¼ ì•„ë˜ ì½”ë“œë¡œ ê°ˆì•„ë¼ì›Œ.

// íƒ€ì…ì€ íŒŒì¼ ìœ„ìª½ ì•„ë¬´ë°ë‚˜ ê°™ì´ ì„ ì–¸
type CoinMeta = {
  name_ko: string | null;
  name_en: string | null;
  icon_url: string | null;
};

async function fetchCoinMetadata(): Promise<Record<string, CoinMeta>> {
  // 1) ê° ê±°ë˜ì†Œ ë§ˆì¼“ ë©”íƒ€ (í•œê¸€/ì˜ë¬¸ ì´ë¦„)
  const { data: marketData, error: marketError } = await supabase
    .from("exchange_markets")
    .select("base_symbol, name_ko, name_en");

  if (marketError || !marketData) {
    console.error("[fetchCoinMetadata] exchange_markets error:", marketError);
    return {};
  }

  // 2) master_symbols ë©”íƒ€ (ko_name/en_name + icon_url)
  const { data: masterData, error: masterError } = await supabase
    .from("master_symbols")
    .select("symbol, ko_name, en_name, icon_url");

  if (masterError || !masterData) {
    console.error("[fetchCoinMetadata] master_symbols error:", masterError);
  }

  const masterMap = new Map<
    string,
    { ko_name: string | null; en_name: string | null; icon_url: string | null }
  >();

  for (const row of masterData ?? []) {
    masterMap.set(row.symbol, {
      ko_name: row.ko_name ?? null,
      en_name: row.en_name ?? null,
      icon_url: row.icon_url ?? null,
    });
  }

  // 3) ìµœì¢… ë©”íƒ€ë§µ ìƒì„± (master_symbols > exchange_markets ìš°ì„ ìˆœìœ„)
  const meta: Record<string, CoinMeta> = {};

  for (const row of marketData) {
    const base = row.base_symbol as string;
    const master = masterMap.get(base);

    meta[base] = {
      // master_symbols.ko_name ì´ ìˆìœ¼ë©´ ê·¸ê±¸ ìš°ì„ , ì—†ìœ¼ë©´ exchange_markets.name_ko
      name_ko: (master?.ko_name ?? row.name_ko) ?? null,
      // master_symbols.en_name ìš°ì„ , ì—†ìœ¼ë©´ name_en
      name_en: (master?.en_name ?? row.name_en) ?? null,
      // icon_url ì€ master_symbols ì—ì„œë§Œ ì˜¨ë‹¤
      icon_url: master?.icon_url ?? null,
    };
  }

  return meta;
}


ì´ë ‡ê²Œ í•˜ë©´:

meta["BTC"] = { name_ko: "ë¹„íŠ¸ì½”ì¸", name_en: "Bitcoin", icon_url: "https://..." }

ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì „ë¶€ ë§Œë“¤ì–´ì§€ê³ 

ë‚˜ì¤‘ì— ì‘ë‹µ ë§Œë“¤ ë•Œ row.symbol ê¸°ì¤€ìœ¼ë¡œ meta[row.symbol] êº¼ë‚´ ì“°ë©´ ë¨.

2ë‹¨ê³„. API ì‘ë‹µì— icon_urlì„ ì‹¤ì œë¡œ ë„£ì–´ì£¼ê¸°

ì§€ê¸ˆ PremiumTable ìª½ì€ ì´ë¯¸ icon_url í•„ë“œë¥¼ ê¸°ëŒ€í•˜ê³  ìˆì–´:

interface PremiumData {
  ...
  name_ko?: string;
  name_en?: string;
  icon_url?: string;
}


ê·¸ëŸ¬ë©´ APIì—ì„œ ìµœì¢… return í•˜ëŠ” ë¶€ë¶„ì— ì´ í•„ë“œë¥¼ ë”± í•œ ì¤„ë§Œ ì¶”ê°€í•´ ì£¼ë©´ ëë‚œë‹¤.

/api/premium/table í•¸ë“¤ëŸ¬ ì•ˆì—ì„œ,
ê°€ê²©/ê¹€í”„ ê³„ì‚° ëë‚˜ê³  ê° ì½”ì¸ë³„ë¡œ rows.map(...) í•˜ëŠ” ë¶€ë¶„ì´ ì•„ë§ˆ ìˆì„ ê±°ì•¼.
ê±°ê¸°ì„œ í˜„ì¬ëŠ” ëŒ€ì¶© ì´ëŸ° ì‹ì¼ ê°€ëŠ¥ì„±ì´ ë†’ìŒ(ì˜ˆì‹œ):

const coinMeta = await fetchCoinMetadata();

const responseData = rows.map((row) => {
  const meta = coinMeta[row.symbol] ?? {};

  return {
    symbol: row.symbol,
    name_ko: meta.name_ko ?? null,
    name_en: meta.name_en ?? null,
    cmcSlug: row.cmcSlug ?? null,
    // ... ê°€ê²©/ê¹€í”„ ê¸°íƒ€ í•„ë“œë“¤
  };
});


ì—¬ê¸°ì„œ í•œ ì¤„ë§Œ ë” ì¶”ê°€:

const responseData = rows.map((row) => {
  const meta = coinMeta[row.symbol] ?? {};

  return {
    symbol: row.symbol,
    name_ko: meta.name_ko ?? null,
    name_en: meta.name_en ?? null,
    icon_url: meta.icon_url ?? null,   // â¬… ì´ ì¤„ ì¶”ê°€
    cmcSlug: row.cmcSlug ?? null,
    // ... ë‚˜ë¨¸ì§€ ê·¸ëŒ€ë¡œ
  };
});


ì´ë ‡ê²Œë§Œ í•´ë‘ë©´:

/api/premium/table... JSON ì•ˆì— icon_url: "https://..." ë“¤ì–´ì˜¤ê³ 

í”„ë¡ íŠ¸ì—ì„œ row.icon_url ì •ìƒ ìˆ˜ì‹ 

<CoinIcon iconUrl={row.icon_url} /> ë¡œ ë„˜ê²¨ì¤Œ

CoinIcon.tsx ì—ì„œ iconUrl ìµœìš°ì„ ìœ¼ë¡œ ì“°ë‹ˆê¹Œ
ğŸ‘‰ ì´ì œ ì§„ì§œ ê±°ë˜ì†Œ ì›ë³¸ ì•„ì´ì½˜ì´ ë°”ë¡œ ëœ¨ê²Œ ë¨.