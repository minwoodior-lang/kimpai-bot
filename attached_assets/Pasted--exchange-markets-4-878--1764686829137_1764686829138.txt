[í”¼ë“œë°± / ì¶”ê°€ ìˆ˜ì • ìš”ì²­]

ìƒì„¸ êµ¬í˜„/ë³´ê³  ê°ì‚¬í•©ë‹ˆë‹¤.
ë‹¤ë§Œ, ì§€ê¸ˆ exchange_markets ìƒíƒœë¥¼ ë³´ë©´ ì—¬ì „íˆ ì˜ˆì „ êµ¬ì¡°(ì—…ë¹„íŠ¸ 4 + ë¹—ì¸ 878) ê·¸ëŒ€ë¡œë¼,
ìš°ë¦¬ê°€ í•©ì˜í–ˆë˜ â€œ3ê°œ ê±°ë˜ì†Œ ì „ì²´ ë§ˆì¼“ ìë™ ë™ê¸°í™”â€ê°€ ì•„ì§ ë°˜ì˜ë˜ì§€ ì•Šì€ ìƒí™©ì…ë‹ˆë‹¤.

1) í˜„ì¬ DB ìƒíƒœ
SELECT exchange, COUNT(*) 
FROM public.exchange_markets
GROUP BY exchange;


ì‹¤ì œ ê²°ê³¼:

UPBIT: 4

BITHUMB: 878

COINONE: 0

í•©ê³„: 882 row

ì´ê±´ ì˜ˆì „ì— ì“°ë˜ â€œì—…ë¹„íŠ¸ ëŒ€í‘œ 4ë§ˆì¼“ + ë¹—ì¸ ì „ì²´ 878ë§ˆì¼“â€ ë°©ì‹ ê·¸ëŒ€ë¡œì…ë‹ˆë‹¤.

í•˜ì§€ë§Œ ê·¸ ì „ì— ì œê°€ ì§ì ‘ ìˆ˜ì§‘í•´ë‘” ìˆ«ìëŠ”:

ì—…ë¹„íŠ¸: KRW 229 / BTC 274 / USDT 161 â†’ ì´ 664

ë¹—ì¸: KRW 439 / BTC 14 / USDT 0 â†’ ì´ 453

ì½”ì¸ì›: KRW 390 â†’ ì´ 390

â†’ ì´ë ‡ê²Œ í•˜ë©´ ì´ 1507ê°œ ì •ë„ê°€ ë‚˜ì™€ì•¼ ì •ìƒì…ë‹ˆë‹¤.

ì§€ê¸ˆ 882ê°œë§Œ ë“¤ì–´ê°€ ìˆê³ , COINONEì´ 0ê°œì¸ ê±¸ ë³´ë©´:

fetchUpbitMarkets / fetchCoinoneMarketsê°€ ê±°ì˜ ë¹„ì–´ ìˆê±°ë‚˜ í•„í„°ë¡œ ë‹¤ ê±¸ëŸ¬ì§€ê³  ìˆê±°ë‚˜

allMarketsê°€ ì•„ë‹ˆë¼ bithumbMarketsë§Œ insert ë˜ê³  ìˆê±°ë‚˜

ë‘˜ ì¤‘ í•˜ë‚˜ì¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

2) refreshExchangeMarkets.ts í™•ì¸ ìš”ì²­

scripts/refreshExchangeMarkets.ts ì•ˆì—ì„œ ì‹¤ì œë¡œ ì•„ë˜ì²˜ëŸ¼ ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤:

const upbitMarkets   = await fetchUpbitMarkets();
const bithumbMarkets = await fetchBithumbMarkets();
const coinoneMarkets = await fetchCoinoneMarkets();

console.log("counts", {
  upbit: upbitMarkets.length,
  bithumb: bithumbMarkets.length,
  coinone: coinoneMarkets.length,
});

const allMarkets = [
  ...upbitMarkets,
  ...bithumbMarkets,
  ...coinoneMarkets,
];

// ì—¬ê¸°ì„œ exchange_markets ë¹„ìš°ê³  allMarkets ì „ì²´ insert
await supabase
  .from("exchange_markets")
  .delete()
  .gte("id", 0);

const { error } = await supabase
  .from("exchange_markets")
  .insert(allMarkets);


ìš”ì²­ì‚¬í•­:

ìœ„ì²˜ëŸ¼ console.log("counts", ...)ë¥¼ ì¶”ê°€í•´ ì£¼ì‹œê³ 

npm run refresh:exchange-markets ì‹¤í–‰ í›„, í„°ë¯¸ë„ì— ì°íŒ:

counts { upbit: X, bithumb: Y, coinone: Z }


ì‹¤ì œ ìˆ«ìê°€ ì–´ë–»ê²Œ ë‚˜ì˜¤ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”.

ì •ìƒì´ë¼ë©´:

upbit: 600ëŒ€

bithumb: 400ëŒ€

coinone: 300ëŒ€

ì²˜ëŸ¼ ë‚˜ì™€ì•¼ í•©ë‹ˆë‹¤.

ë§Œì•½ ì—¬ê¸°ì„œë¶€í„°:

upbit: 4, bithumb: 878, coinone: 0 ì´ ì°íˆë©´
â†’ fetchUpbitMarkets / fetchCoinoneMarkets ë¡œì§ì´ ì•„ì§ ë°˜ì˜ë˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  insert ë¶€ë¶„ì—ì„œ:

.insert(allMarkets)


ê°€ ì•„ë‹ˆë¼,

.insert(bithumbMarkets)


ë§Œ ì‚¬ìš©ë˜ê³  ìˆì§€ëŠ” ì•Šì€ì§€ë„ í•œ ë²ˆ í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

3) master_symbols / Supabase ìºì‹œ ì´ìŠˆëŠ” ë‚˜ì¤‘ ë¬¸ì œ

ì§€ê¸ˆì€ exchange_marketsì— ë°ì´í„°ê°€ 882ê°œë¡œ ì˜ëª» ë“¤ì–´ê°€ ìˆì–´ì„œ,
updateMasterSymbols.tsê°€ ì˜ ëŒì•„ê°€ë„ ì½”ì¸ì› ì‹¬ë³¼ì€ ì• ì´ˆì— ìƒì„±ë  ìˆ˜ ì—†ëŠ” ìƒíƒœì…ë‹ˆë‹¤.

ë¨¼ì € refreshExchangeMarkets.tsì—ì„œ
UPBIT + BITHUMB + COINONE ì „ì²´ ë§ˆì¼“ì´ ë“¤ì–´ì˜¤ëŠ”ì§€ë¥¼ í™•ì¸í•˜ê³ 

ê·¸ ë‹¤ìŒì— npm run sync:symbolsë¥¼ ë‹¤ì‹œ ëŒë ¤ë³´ëŠ” ê²Œ ìˆœì„œë¼ê³  ìƒê°í•©ë‹ˆë‹¤.

ëª©í‘œ ìµœì¢… ìƒíƒœ

SELECT exchange, COUNT(*) FROM exchange_markets GROUP BY exchange; ê²°ê³¼ê°€

UPBIT: 664 ë‚´ì™¸ (KRW + BTC + USDT ì „ì²´)

BITHUMB: 453 ë‚´ì™¸ (KRW + BTC ì „ì²´)

COINONE: 390 ë‚´ì™¸ (KRW ì „ì²´)

ê°€ ë‚˜ì˜¤ë„ë¡ refreshExchangeMarkets.tsë¥¼ ì™„ì„±

ê·¸ í›„:

npm run sync:symbols


ì‹¤í–‰ â†’ master_symbols 400~500ê°œ ì •ë„ ìƒì„±

í”„ë¡ íŠ¸ì—ì„œëŠ” name_ko ?? name_en ?? symbol ë¡œ ì½”ì¸ëª…ì´ ì˜ ë‚˜ì˜¤ëŠ”ì§€ë¥¼ ì œê°€ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.

ì´ ë¶€ë¶„ë§Œ ì •ë¦¬ë˜ë©´,
ì´ì œë¶€í„°ëŠ” ì§„ì§œë¡œ npm run sync:symbols í•œ ë²ˆìœ¼ë¡œ
ì—…ë¹„íŠ¸/ë¹—ì¸/ì½”ì¸ì› ì „ì²´ ë§ˆì¼“ + ì‹¬ë³¼/í•œê¸€ëª…ì´ ìë™ ë™ê¸°í™”ë˜ëŠ” êµ¬ì¡°ê°€ ì™„ì„±ë©ë‹ˆë‹¤. ğŸ™